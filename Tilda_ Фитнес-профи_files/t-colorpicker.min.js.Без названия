(()=>{"use strict";function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}function e(t){var e=c();return function(){var n,a=i(t);if(e){var r=i(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return function(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,n)}}function n(t){var e="function"==typeof Map?new Map:void 0;return n=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,a)}function a(){return l(t,arguments,i(this).constructor)}return a.prototype=Object.create(t.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),h(a,t)},n(t)}function i(t){return i=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},i(t)}function a(){a=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},l=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",h=s.toStringTag||"@@toStringTag";function d(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(t){d=function(t,e,n){return t[e]=n}}function u(t,e,n,i){var a=e&&e.prototype instanceof f?e:f,s=Object.create(a.prototype),o=new A(i||[]);return r(s,"_invoke",{value:I(t,n,o)}),s}function _(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var p="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function f(){}function C(){}function b(){}var k={};d(k,l,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(R([])));E&&E!==n&&i.call(E,l)&&(k=E);var L=b.prototype=f.prototype=Object.create(k);function S(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(a,r,s,l){var c=_(t[a],t,r);if("throw"!==c.type){var h=c.arg,d=h.value;return d&&"object"==o(d)&&i.call(d,"__await")?e.resolve(d.__await).then((function(t){n("next",t,s,l)}),(function(t){n("throw",t,s,l)})):e.resolve(d).then((function(t){h.value=t,s(h)}),(function(t){return n("throw",t,s,l)}))}l(c.arg)}var a;r(this,"_invoke",{value:function(t,i){function r(){return new e((function(e,a){n(t,i,e,a)}))}return a=a?a.then(r,r):r()}})}function I(e,n,i){var a=p;return function(r,s){if(a===v)throw new Error("Generator is already running");if(a===y){if("throw"===r)throw s;return{value:t,done:!0}}for(i.method=r,i.arg=s;;){var o=i.delegate;if(o){var l=P(o,i);if(l){if(l===g)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===p)throw a=y,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=v;var c=_(e,n,i);if("normal"===c.type){if(a=i.done?y:m,c.arg===g)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(a=y,i.method="throw",i.arg=c.arg)}}}function P(e,n){var i=n.method,a=e.iterator[i];if(a===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var r=_(a,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,g;var s=r.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function N(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(N,this),this.reset(!0)}function R(e){if(e||""===e){var n=e[l];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function n(){for(;++a<e.length;)if(i.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError(o(e)+" is not iterable")}return C.prototype=b,r(L,"constructor",{value:b,configurable:!0}),r(b,"constructor",{value:C,configurable:!0}),C.displayName=d(b,h,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===C||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,d(t,h,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},S(x.prototype),d(x.prototype,c,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,i,a,r){void 0===r&&(r=Promise);var s=new x(u(t,n,i,a),r);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},S(L),d(L,h,"Generator"),d(L,l,(function(){return this})),d(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=R,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(i,a){return o.type="throw",o.arg=e,n.next=i,a&&(n.method="next",n.arg=t),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],o=s.completion;if("root"===s.tryLoc)return a("end");if(s.tryLoc<=this.prev){var l=i.call(s,"catchLoc"),c=i.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return a(s.catchLoc,!0);if(this.prev<s.finallyLoc)return a(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return a(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return a(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var s=r?r.completion:{};return s.type=t,s.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var a=i.arg;T(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:R(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}function r(t,e,n,i,a,r,s){try{var o=t[r](s),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,a)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(i,a){var s=t.apply(e,n);function o(t){r(s,i,a,o,l,"next",t)}function l(t){r(s,i,a,o,l,"throw",t)}o(void 0)}))}}function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function l(t,e,n){return l=c()?Reflect.construct.bind():function(t,e,n){var i=[null];i.push.apply(i,e);var a=new(Function.bind.apply(t,i));return n&&h(a,n.prototype),a},l.apply(null,arguments)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function d(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,a,r,s,o=[],l=!0,c=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){c=!0,a=t}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw a}}return o}}(t,e)||_(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(a=i.key,r=void 0,r=function(t,e){if("object"!==o(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(a,"string"),"symbol"===o(r)?r:String(r)),i)}var a,r}function y(t,e,n){return e&&v(t.prototype,e),n&&v(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var g=function(){function t(e,n){m(this,t),n="[object Object]"===Object.prototype.toString.call(n)?n:{};var i="[object Object]"===Object.prototype.toString.call(n.gradientHint)?n.gradientHint:{};if(i.EN="string"==typeof i.EN&&i.EN||"",i.RU="string"==typeof i.RU&&i.RU||i.EN||"",!(e instanceof Element||n.inputReplacement instanceof Element))throw new TypeError("TColorPicker input is not an Element");this._config={letterCase:["lowercase","uppercase"].includes(n.letterCase)?n.letterCase:"uppercase",format:["hex","rgb","hsl"].includes(n.format)?n.format:"hex",isOpacityEnabled:!!n.isOpacityEnabled,isGradientsEnabled:!!n.isGradientsEnabled,position:["bottom-left","top-left","right-top","left-top","bottom-right"].includes(n.position)?n.position:"bottom-left",swatchesKey:n.swatchesKey||null,theme:["light","dark"].includes(n.theme)?n.theme:"light",panelZIndex:isNaN(n.panelZIndex)?99999:n.panelZIndex,emptyColorKeywords:Array.isArray(n.emptyColorKeywords)?n.emptyColorKeywords:[],noDocumentColors:!!n.noDocumentColors,swatchSize:!isNaN(n.swatchSize)&&n.swatchSize>=0?n.swatchSize:35,swatchGap:!isNaN(n.swatchGap)&&n.swatchGap>=0?n.swatchGap:13,panelGap:!isNaN(n.panelGap)&&n.panelGap>=0?n.panelGap:-3,lang:["RU","EN"].includes(n.lang)?n.lang:["RU","EN"].includes(window.lang)?window.lang:"EN",inputReplacement:n.inputReplacement instanceof Element?n.inputReplacement:null,disablePanelToggleOnInputReplacementClick:!!n.disablePanelToggleOnInputReplacementClick,colorChangeDelay:!isNaN(n.colorChangeDelay)&&n.colorChangeDelay>=0?n.colorChangeDelay:50,isGradientOpacityOnly:!!n.isGradientOpacityOnly,bottomGap:!isNaN(n.bottomGap)&&n.bottomGap>=0?n.bottomGap:0,isTextContrastCheckEnabled:!!n.isTextContrastCheckEnabled,isPanelFixed:!!n.isPanelFixed,gradientHint:{EN:i.EN,RU:i.RU},isShowGradientHint:!!i.EN,clearBtnSize:!isNaN(n.clearBtnSize)&&n.clearBtnSize>=0?n.clearBtnSize:16},this._classNames={container:"tcolors",containerThemeDark:"tcolors_dark",input:"tcolors__input",swatch:"tcolors__swatch",panel:"tcolors-panel",panelThemeDark:"tcolors-panel_dark",gradientPlaceholder:"tcolors__gradient-placeholder",clearBtn:"tcolors__clear-btn"},this._input=e||null,this._container=null,this._swatch=null,this._currentColor=null,this._currentOpacity=1,this._currentGradient=null,this._panel=null,this._eventColor=null,this._isColorChangedByInput=!1,this._isInited=!1,this._handleDocClick=this._handleDocClick.bind(this),this._handleDocKeyUp=this._handleDocKeyUp.bind(this),this._handleInputKeyUp=this._handleInputKeyUp.bind(this),this._handleInputBlur=this._handleInputBlur.bind(this),this._handleSwatchClick=this._handleSwatchClick.bind(this),this._handleInputPaste=this._handleInputPaste.bind(this),this._handleInput=this._handleInput.bind(this),this._openPanel=this._openPanel.bind(this),this._closePanel=this._closePanel.bind(this),this._handleContainerBlur=this._handleContainerBlur.bind(this),this._dispatchColorChangeEvent=f.throttle(this._dispatchColorChangeEvent.bind(this),this._config.colorChangeDelay),this._handleInputReplacementClick=this._handleInputReplacementClick.bind(this),this._handleClearClick=this._handleClearClick.bind(this),this._handleContainerMouseEnter=this._handleContainerMouseEnter.bind(this),this._handleContainerMouseLeave=this._handleContainerMouseLeave.bind(this)}return y(t,[{key:"init",value:function(){var t=this;if(!this._isInited){this._isInited=!0;var e=this._config.inputReplacement;e?(e.classList.add(this._classNames.container),e.addEventListener("click",this._handleInputReplacementClick),this._config.disablePanelToggleOnInputReplacementClick||e.addEventListener("click",this._openPanel)):(this._input.classList.add(this._classNames.input),this._container=document.createElement("div"),this._container.classList.add(this._classNames.container),"dark"===this._config.theme&&this._container.classList.add(this._classNames.containerThemeDark),this._input.insertAdjacentElement("afterend",this._container),this._input.style.paddingLeft="".concat(this._config.swatchSize+this._config.swatchGap,"px"),this._input.setAttribute("inputmode","none"),this._input.setAttribute("autocomplete","off"),this._container.appendChild(this._input),this._swatch=document.createElement("div"),this._swatch.classList.add(this._classNames.swatch),this._swatch.style.width="".concat(this._config.swatchSize,"px"),this._swatch.style.height="".concat(this._config.swatchSize,"px"),this._container.appendChild(this._swatch),this._clearBtn=document.createElement("div"),this._clearBtn.classList.add(this._classNames.clearBtn,this._classNames.clearBtn+"_hidden"),this._clearBtn.setAttribute("role","button"),this._clearBtn.style.width="".concat(this._config.clearBtnSize,"px"),this._clearBtn.style.height="".concat(this._config.clearBtnSize,"px"),this._clearBtnTooltip=new S({element:this._clearBtn,zIndex:this._config.panelZIndex+1,text:"RU"===this._config.lang?"Очистить":"Clear",theme:this._config.theme,onHover:function(){t._container.classList.add(t._classNames.container+"_clear-btn-visible")},onLeave:function(){t._panel.panelState||t._container.classList.remove(t._classNames.container+"_clear-btn-visible")},onClick:function(){t._clearBtn.dispatchEvent(new Event("click")),t._clearBtnTooltip.remove()}}),this._input.disabled||this._container.appendChild(this._clearBtn),this._container.addEventListener("mouseenter",this._handleContainerMouseEnter),this._container.addEventListener("mouseleave",this._handleContainerMouseLeave),this._container.style.setProperty("--padding-right","".concat(this._config.clearBtnSize+4,"px")),this._input.addEventListener("keyup",this._handleInputKeyUp),this._input.addEventListener("keydown",this._handleInputKeyDown),this._input.addEventListener("blur",this._handleInputBlur),this._input.addEventListener("paste",this._handleInputPaste),this._input.addEventListener("input",this._handleInput),this._swatch.addEventListener("click",this._handleSwatchClick),this._clearBtn.addEventListener("click",this._handleClearClick),this._container.addEventListener("focusin",this._openPanel),this._container.addEventListener("focusout",this._handleContainerBlur)),this._panel=new f({className:this._classNames.panel,classNameDark:this._classNames.panelThemeDark,position:this._config.position,swatchesKey:this._config.swatchesKey,isOpacityEnabled:this._config.isOpacityEnabled,isGradientsEnabled:this._config.isGradientsEnabled,anchorElement:this._input||e,onChange:this._handleColorChange.bind(this),zIndex:this._config.panelZIndex,input:this._input,container:e||this._container,noDocumentColors:this._config.noDocumentColors,lang:this._config.lang,panelGap:this._config.panelGap,isNoInputMode:!!e,isGradientOpacityOnly:this._config.isGradientOpacityOnly,bottomGap:this._config.bottomGap,isTextContrastCheckEnabled:this._config.isTextContrastCheckEnabled,theme:this._config.theme,isPanelFixed:this._config.isPanelFixed,isShowGradientHint:this._config.isShowGradientHint,gradientHint:this._config.gradientHint}),this._panel.init(),this._panel.panelElement.addEventListener("focusout",this._handleContainerBlur),e||window.setTimeout((function(){return t._setColorByInput(!0,!0)}),0)}}},{key:"destroy",value:function(){if(this._isInited){this._isInited=!1;var t=this._config.inputReplacement;t?(t.classList.remove(this._classNames.container),t.removeEventListener("click",this._handleInputReplacementClick),t.removeEventListener("click",this._openPanel)):(this._swatch.remove(),this._input.style.removeProperty("padding-left"),this._input.removeAttribute("inputmode"),this._container.insertAdjacentElement("beforebegin",this._input),this._container.remove(),this._input.removeEventListener("keyup",this._handleInputKeyUp),this._input.removeEventListener("keydown",this._handleInputKeyDown),this._input.removeEventListener("blur",this._handleInputBlur),this._input.removeEventListener("paste",this._handleInputPaste),this._input.removeEventListener("input",this._handleInput),this._swatch&&this._swatch.removeEventListener("click",this._handleSwatchClick),this._clearBtn&&this._clearBtn.removeEventListener("click",this._handleClearClick),this._clearBtnTooltip&&this._clearBtnTooltip.destroy(),this._container.removeEventListener("focusin",this._openPanel),this._container.removeEventListener("focusout",this._handleContainerBlur),this._container.removeEventListener("mouseenter",this._handleContainerMouseEnter),this._container.removeEventListener("mouseleave",this._handleContainerMouseLeave)),document.removeEventListener("click",this._handleDocClick),document.removeEventListener("keyup",this._handleDocKeyUp),this._panel.panelElement.removeEventListener("focusout",this._handleContainerBlur),this._panel.destroy()}}},{key:"panelElement",get:function(){return this._isInited?this._panel.panelElement:null}},{key:"panelState",get:function(){return this._isInited?this._panel.panelState:null}},{key:"openPanel",value:function(){this._openPanel()}},{key:"closePanel",value:function(){this._closePanel()}},{key:"_handleClearClick",value:function(t){t.preventDefault(),this._input.value="",this._input.dispatchEvent(new Event("input")),this._clearBtnTooltip.remove()}},{key:"_handleContainerMouseEnter",value:function(){this._container.classList.add(this._classNames.container+"_clear-btn-visible")}},{key:"_handleContainerMouseLeave",value:function(){this._panel.panelState||this._container.classList.remove(this._classNames.container+"_clear-btn-visible")}},{key:"_setColorByInput",value:function(e,n){this._isColorChangedByInput=!0;for(var i=this._input.value,a=this._input.value.replace(/[^0-9A-Za-z]/g,""),r="",s=0;s<this._config.emptyColorKeywords.length;s++){if(this._config.emptyColorKeywords[s]===i){r=i;break}}if(!i||r||!a)return this._panel.color=null,this._panel.opacity=1,this._handleColorChange(e),this._container.style.setProperty("--current-color","transparent"),this._input.value=r,void this._clearBtn.classList.add(this._classNames.clearBtn+"_hidden");var o=t.parseGradient(i,n);if(this._config.isGradientsEnabled&&o)this._panel.gradient=o;else{var l=t.parseColor(i,n),c=1;4===l.length?(this._config.isOpacityEnabled&&!this._config.isGradientOpacityOnly&&(c=l[3]),l.splice(3)):c=1,this._panel.color=l,this._panel.opacity=c}this._handleColorChange(e)}},{key:"_handleSwatchClick",value:function(){var t=this;window.setTimeout((function(){t._input&&t._input.focus()}),0)}},{key:"_openPanel",value:function(){this._panel.panelState||(this._input||this._config.inputReplacement).disabled||(this._panel.open(),this._container&&this._container.classList.add(this._classNames.container+"_clear-btn-visible"),document.addEventListener("click",this._handleDocClick),document.addEventListener("keyup",this._handleDocKeyUp),this._config.inputReplacement?this._config.inputReplacement.removeEventListener("click",this._openPanel):this._container&&this._swatch&&(this._swatch.removeEventListener("click",this._handleSwatchClick),this._container.removeEventListener("focusin",this._openPanel)))}},{key:"_closePanel",value:function(){this._panel.close(),this._panel.panelState||(this._input&&this._input.blur(),this._container&&this._container.classList.remove(this._classNames.container+"_clear-btn-visible"),document.removeEventListener("click",this._handleDocClick),document.removeEventListener("keyup",this._handleDocKeyUp),this._config.inputReplacement&&!this._config.disablePanelToggleOnInputReplacementClick?this._config.inputReplacement.addEventListener("click",this._openPanel):this._container&&this._swatch&&(this._swatch.addEventListener("click",this._handleSwatchClick),this._container.addEventListener("focusin",this._openPanel)))}},{key:"_handleDocClick",value:function(t){var e=t.clientX,n=t.clientY,i=document.elementFromPoint(e,n)||document.body;(this._container||this._config.inputReplacement).contains(t.target)||this._panel.panelElement.contains(t.target)||t.target.closest(".t-tooltip")||i.closest(".t-tooltip")||this._closePanel()}},{key:"_handleDocKeyUp",value:function(t){"Escape"===t.key&&this._closePanel()}},{key:"_handleInputReplacementClick",value:function(t){if(!this._config.disablePanelToggleOnInputReplacementClick){var e=document.activeElement;this._panel.panelElement.contains(t.target)||this._panel.panelElement===t.target||e!==this._config.inputReplacement||(this._panel.panelState?this._closePanel():this._openPanel())}}},{key:"_handleContainerBlur",value:function(t){t.relatedTarget&&this._container&&!this._container.contains(t.relatedTarget)&&this._panel.panelElement&&!this._panel.panelElement.contains(t.relatedTarget)&&this._closePanel()}},{key:"_handleInputKeyUp",value:function(t){"Enter"===t.key&&this._setColorByInput()}},{key:"_handleInputKeyDown",value:function(t){"Enter"===t.key&&t.preventDefault()}},{key:"_handleInputBlur",value:function(){var t=this._input.value.replace(/[^0-9A-Za-z]/g,"");this._input.value&&t?this._formatInputValue():this._setColorByInput(!0)}},{key:"_formatInputValue",value:function(e,n){if(!n)for(var i=this._input.value,a=0;a<this._config.emptyColorKeywords.length;a++){if(this._config.emptyColorKeywords[a]===i)return}if(this._config.isGradientsEnabled&&this._currentGradient&&!e){var r=k.gradientToCSS(this._currentGradient);this._input.value=r}else{var s=this._config.format,o="uppercase"===this._config.letterCase;if("hex"===s){var l=t.hslToHEX(this._currentColor);l=o?l.toUpperCase():l.toLowerCase(),this._input.value="#"+l}else if("rgb"===s){var c=t.hslToRGB(this._currentColor);c="rgb(".concat(c.join(", "),")"),c=o?c.toUpperCase():c.toLowerCase(),this._input.value=c}else if("hsl"===s){var h=u(this._currentColor,3),d=h[0],_=h[1],p=h[2],m="hsl(".concat(360*Math.round(d),", ").concat(Math.round(100*_),"%, ").concat(Math.round(100*p),"%)");m=o?m.toUpperCase():m.toLowerCase(),this._input.value=m}}}},{key:"_handleInputPaste",value:function(){var t=this;setTimeout((function(){t._setColorByInput()}),0)}},{key:"_handleInput",value:function(){var t=this._input.value,e=this._input.selectionStart,n=this._input.selectionEnd;this._setColorByInput(),this._input.value=t,this._input.selectionStart=e,this._input.selectionEnd=n}},{key:"_handleColorChange",value:function(e,n){if(this._config.inputReplacement){if(e)return;return this._currentColor=this._panel.color,this._currentOpacity=this._panel.opacity,this._currentGradient=this._panel.gradient,this._eventColor=[n?null:this._currentColor,n?null:this._currentOpacity,n?null:this._currentGradient],void this._dispatchColorChangeEvent()}var i=this._input.value;if(this._currentColor=this._panel.color,this._currentOpacity=this._panel.opacity,this._currentGradient=this._panel.gradient,this._formatInputValue(!1,!0),this._config.isGradientsEnabled&&this._currentGradient){var a=k.gradientToCSS(this._currentGradient);this._container.style.setProperty("--current-color",a)}else{var r=t.hslToRGB(this._currentColor);this._container.style.setProperty("--current-color","rgba(".concat(r.join(", "),", ").concat(this._currentOpacity,")"))}if(this._clearBtn.classList.remove(this._classNames.clearBtn+"_hidden"),!e){for(var s="",o=0;o<this._config.emptyColorKeywords.length;o++){if(this._config.emptyColorKeywords[o]===i){s=i;break}}var l=this._isColorChangedByInput&&(!i||!i.replace(/[^a-zA-Z0-9]/g,"")||s)&&(!this._currentColor||t.compareArrays(this._currentColor,[0,0,0]));this._eventColor=[l||this._panel._isEmptyColor?null:this._currentColor,l||this._panel._isEmptyColor?null:this._currentOpacity,l||this._panel._isEmptyColor?null:this._currentGradient],this._dispatchColorChangeEvent()}this._isColorChangedByInput=!1}},{key:"_dispatchColorChangeEvent",value:function(){var t=l(b,d(this._eventColor));this._config.inputReplacement?this._config.inputReplacement.dispatchEvent(t):this._input.dispatchEvent(t)}},{key:"color",get:function(){return this._isInited?this._currentColor:null},set:function(e){if(this._isInited){for(var n=this._config.inputReplacement,i="",a=0;a<this._config.emptyColorKeywords.length;a++){if(this._config.emptyColorKeywords[a]===e){i=e;break}}if(e&&!i){if((e=t.parseColor(e))&&4===e.length&&((this._config.isOpacityEnabled&&!this._config.isGradientOpacityOnly||1===e[3])&&(this._currentOpacity=e[3],this._panel.opacity=e[3]),e.splice(3)),this._panel.gradient=null,this._currentColor=e,this._panel.color=e,!n){this._formatInputValue(!0,!0);var r=t.hslToRGB(this._currentColor);this._container.style.setProperty("--current-color","rgba(".concat(r.join(", "),", ").concat(this._currentOpacity,")")),this._clearBtn.classList.remove(this._classNames.clearBtn+"_hidden")}}else n?(this._panel.color=null,this._panel.opacity=1):(this._input.value=i,this._setColorByInput(!0))}}},{key:"opacity",get:function(){return this._isInited?this._currentOpacity:null},set:function(e){if(this._isInited&&this._currentColor){var n=this._config.inputReplacement;if((this._config.isOpacityEnabled&&!this._config.isGradientOpacityOnly||1===e)&&(this._panel.gradient=null,this._currentGradient=null,this._panel.opacity=e,this._currentOpacity=e,!n)){this._formatInputValue(!0,!0);var i=t.hslToRGB(this._currentColor);this._container.style.setProperty("--current-color","rgba(".concat(i.join(", "),", ").concat(this._currentOpacity,")")),this._clearBtn.classList.remove(this._classNames.clearBtn+"_hidden")}}}},{key:"gradient",get:function(){return this._isInited?this._currentGradient:null},set:function(t){var e=this;if(this._isInited&&this._config.isGradientsEnabled){if(!t)return this._currentGradient=null,void(this._panel.gradient=null);t.stops.forEach((function(t){e._config.isOpacityEnabled?t.opacity=!isNaN(t.opacity)&&t.opacity>=0&&t.opacity<=1?t.opacity:1:t.opacity=1})),this._currentGradient=t,this._panel.gradient=t,this._config.isOpacityEnabled&&(this._currentOpacity=t.stops[0].opacity,this._panel.opacity=t.stops[0].opacity)}}},{key:"theme",set:function(t){this._isInited&&("light"===t&&this._container?this._container.classList.remove(this._classNames.containerThemeDark):"dark"===t&&this._container&&this._container.classList.add(this._classNames.containerThemeDark),this._panel.theme=t)}}],[{key:"parseColor",value:function(e,n){if(!e)return[0,0,0];var i,a=function(i){if(!n){var a=t.getColorByWord(i);a&&(i=a,e=a)}return i.startsWith("rgba")?"rgba":i.startsWith("rgb")?"rgb":i.startsWith("hsl")?"hsl":"hex"}(e=String(e).toLowerCase());return"rgb"===a?((i=e.replace(/[^0-9,.]/g,"").split(",")).splice(3,i.length),i.length?(1===(i=i.map((function(t){var e=parseFloat(t)||0;return e>255?255:e}))).length&&i.push(0,0),2===i.length&&i.push(0),t.rgbToHSL(i)):[0,0,0]):"rgba"===a?function(e){var n=e.replace(/[^0-9,.]/g,"").split(",");return n.splice(4,n.length),n.length?(1===n.length&&n.push(0,0,1),2===n.length&&n.push(0,1),3===n.length&&n.push(1),(n=n.map((function(t,e){if(3===e){var n=parseFloat(t);return n=(n=isNaN(n)?1:n)>1?1:n<0?0:n}var i=parseInt(t,10)||0;return i=i>255?255:i<0?0:i})))[3]=parseFloat(n[3].toFixed(2)),[].concat(d(t.rgbToHSL([n[0],n[1],n[2]])),[n[3]])):[0,0,0,1]}(e):"hsl"===a?function(t){var e=t.replace(/[^0-9,.]/g,"").split(",");return e.splice(3,e.length),e.length?(1===(e=e.map((function(t,e){var n=parseFloat(t)||0;return e?n>100?1:n/100:n>360?1:n/360}))).length&&e.push(0,0),2===e.length&&e.push(0),e):[0,0,0]}(e):"hex"===a?function(e){var n=e.replace(/[^0-9a-fA-F]/g,"").substring(0,6).toLowerCase();return n.length?6===n.length?t.hexToHSL(n):(n.length>3&&(n=n.substring(0,3)),n.length<3?(n=n.padEnd(6,n),t.hexToHSL(n)):t.hexToHSL(n[0]+n[0]+n[1]+n[1]+n[2]+n[2])):t.hexToHSL("000000")}(e):[0,0,0]}},{key:"parseGradient",value:function(e,n){if(!e)return!1;return(e=String(e).toLowerCase().replace(/\s{2,}/g,"").replace(/^\s/,"").replace(/\s$/,"")).startsWith("linear-gradient")?function(e){var i=e.match(/^linear-gradient\((.+)\)$/);if(!i)return!1;if(!(i=i[1]))return!1;var a=i.split(/,(?![^(]*\))/);if(a.length<2)return!1;var r,s=a[0];if(s.includes("deg")||s.includes("turn")||s.includes("rad")){var o=s.includes("deg")?"deg":s.includes("turn")?"turn":"rad";s=s.replace(/\s/g,"").replace(/[a-z]/g,""),s=parseFloat(s),s=isNaN(s)?0:s,"deg"===o&&(s/=360),"rad"===o&&(s/=2*Math.PI),s=s>=0&&s<=1?s:1,r=a.splice(1)}else s=0,r=a;var l=!1;return r.splice(15),r=r.map((function(e,i){var a=(e=e.replace(/^\s/,"").replace(/\s$/,"")).split(/\s(?![^(]*\))/);if(!(a.length>2)){var s,o=t.parseColor(a[0],n),c=1;return 4===o.length&&(c=o[3],o.splice(3)),a[1]?(s=a[1].replace(/[^0-9.]/g,""),s=parseFloat(s),s=!isNaN(s)&&s>=0&&s<=100?s:0,s/=100):s=i/(r.length-1),{color:o,position:s,opacity:c}}l=!0})),!l&&(s=parseFloat(s.toFixed(3)),{type:"linear",stops:r,angle:s})}(e):!!e.startsWith("radial-gradient")&&function(e){var i=e.match(/^radial-gradient\((.+)\)$/)[1];if(!i)return!1;var a,r=i.split(/,(?![^(]*\))/);if(r.length<2)return!1;a=r[0].includes("circle")||r[0].includes("ellipse")||r[0].includes("side")||r[0].includes("corner")?r.splice(1):r;var s=!1;return a.splice(15),a=a.map((function(e,i){var r=(e=e.replace(/^\s/,"").replace(/\s$/,"")).split(/\s(?![^(]*\))/);if(!(r.length>2)){var o,l=t.parseColor(r[0],n),c=1;return 4===l.length&&(c=l[3],l.splice(3)),r[1]?(o=r[1].replace(/[^0-9.]/g,""),o=parseFloat(o),o=!isNaN(o)&&o>=0&&o<=100?o:0,o/=100):o=i/(a.length-1),{color:l,position:o,opacity:c}}s=!0})),!s&&{type:"radial",stops:a,angle:0}}(e)}},{key:"hexToRGB",value:function(t){return t=t.replace(/#/g,""),[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]}},{key:"hexToHSL",value:function(e){return t.rgbToHSL(t.hexToRGB(e))}},{key:"hslToRGB",value:function(t){var e=u(t,3),n=e[0],i=e[1],a=e[2];n*=360;var r=(1-Math.abs(2*a-1))*i,s=n/60,o=r*(1-Math.abs(s%2-1)),l=a-r/2,c=u(s>=0&&s<1?[r,o,0]:s>=1&&s<2?[o,r,0]:s>=2&&s<3?[0,r,o]:s>=3&&s<4?[0,o,r]:s>=4&&s<5?[o,0,r]:[r,0,o],3),h=c[0]+l,d=c[1]+l,_=c[2]+l;return[h=Math.round(255*h),d=Math.round(255*d),_=Math.round(255*_)]}},{key:"hslToRGBA",value:function(e){var n=t.hslToRGB(e),i=!isNaN(e[3])&&e[3]>=0&&e[3]<=1?e[3]:1;return i=parseFloat(i.toFixed(2)),[].concat(d(n),[i])}},{key:"rgbToHEX",value:function(t){return t.map((function(t){var e=Number(t).toString(16);return 1===e.length?"0"+e:e})).join("")}},{key:"hslToHEX",value:function(e){return t.rgbToHEX(t.hslToRGB(e))}},{key:"rgbToHSL",value:function(t){var e=u(t,3),n=e[0],i=e[1],a=e[2];n/=255,i/=255,a/=255;var r,s,o=Math.max(n,i,a),l=Math.min(n,i,a),c=o-l,h=(o+l)/2;return 0===c?r=0:o===n?r=(i-a)/c%6*60:o===i?r=60*((a-n)/c+2):o===a&&(r=60*((n-i)/c+4)),s=0===h||1===h?0:(o-h)/Math.min(h,1-h),(r/=360)<0&&(r+=1),[r=parseFloat(r.toFixed(4)),s=parseFloat(s.toFixed(4)),h=parseFloat(h.toFixed(4))]}},{key:"hsvToHSL",value:function(t){var e=u(t,3),n=e[0],i=e[1],a=e[2],r=a*(1-i/2),s=0===r||1===r?0:(a-r)/Math.min(r,1-r);return[n=parseFloat(n.toFixed(4)),s=parseFloat(s.toFixed(4)),r=parseFloat(r.toFixed(4))]}},{key:"hslToHSV",value:function(t){var e=u(t,3),n=e[0],i=e[1],a=e[2],r=a+i*Math.min(a,1-a),s=0===r?0:2*(1-a/r);return[n=parseFloat(n.toFixed(4)),s=parseFloat(s.toFixed(4)),r=parseFloat(r.toFixed(4))]}},{key:"getColorByWord",value:function(t){if(t.toLowerCase().includes("gradient"))return null;var e=document.createElement("div");e.style.position="fixed",e.style.top="-9999px",e.style.left="-9999px",e.style.width="0px",e.style.height="0px";var n="rgb(1, 1, 1)";e.style.color=n,e.style.color=t,document.body.appendChild(e);var i=window.getComputedStyle(e).getPropertyValue("color");return e.remove(),i===n?null:i}},{key:"calcContrastRatio",value:function(e,n){var i=t.calcRelativeLuminance(e),a=t.calcRelativeLuminance(n),r=(Math.max(i,a)+.05)/(Math.min(i,a)+.05);return parseFloat(r.toFixed(2))}},{key:"calcRelativeLuminance",value:function(e){var n=u(t.hslToRGB(e).map((function(t){return(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)})),3);return.2126*n[0]+.7152*n[1]+.0722*n[2]}},{key:"getRelatedElement",value:function(t){var e=t.name;if(!["text_color","title_color","descr_color","subtitle_color"].includes(e))return null;e=e.replace("_color","");var n=t.closest("[data-rec-id]");if(!n)return null;var i=n.getAttribute("data-rec-id");return document.querySelector("#rec".concat(i,' [field="').concat(e,'"]'))||null}},{key:"getBgColor",value:function(e){for(var n=e,i=null;n;){var a=window.getComputedStyle(n),r=a.getPropertyValue("background-color"),s=a.getPropertyValue("background-image");if("rgba(0, 0, 0, 0)"!==r&&"none"===s){i=t.parseColor(r,!0);break}if("none"!==s)break;n=n.parentElement}return i}},{key:"isLargeText",value:function(t){var e=window.getComputedStyle(t),n=e.getPropertyValue("font-size").replace(/[^0-9]/g,""),i=e.getPropertyValue("font-weight");return n>=24||n>=18.66&&i>=700}},{key:"compareArrays",value:function(t,e){var n=!0;if(t.length!==e.length)n=!1;else for(var i=0;i<t.length;i++)if(t[i]!==e[i]){n=!1;break}return n}}]),t}(),f=function(){function t(e){m(this,t),this._className=e.className,this._classNameDark=e.classNameDark,this._position=e.position,this._anchorElement=e.anchorElement,this._swatchesKey=e.swatchesKey,this._isOpacityEnabled=e.isOpacityEnabled,this._isGradientOpacityOnly=e.isGradientOpacityOnly,this._isGradientsEnabled=e.isGradientsEnabled,this._zIndex=e.zIndex,this._input=e.input,this._isNoInputMode=e.isNoInputMode,this._container=e.container,this._noDocumentColors=e.noDocumentColors,this._isTextContrastCheckEnabled=e.isTextContrastCheckEnabled,this._lang=e.lang,this._panelGap=e.panelGap,this._bottomGap=e.bottomGap,this._theme=e.theme,this._isShowGradientHint=e.isShowGradientHint,this._currentColor={color:[0,0,0],opacity:1,gradient:null,contrast:1},this._isPanelFixed=e.isPanelFixed,this._panelHeight=0,this._onChange=e.onChange,this._swatches=[],this._documentColors=[],this._tildaColors=null,this._isPanelVisible=!1,this._isColorAreaDragStart=!1,this._isTcolorsNavDragStart=!1,this._isRangeInputStart=!1,this._anglePickerStart=!1,this._isEmptyColor=!0,this._isTildaColorsDrawed=!1,this._isTildaGradientsDrawed=!1,this._tcolorsNavDragStartPos=null,this._colorAreaRect=null,this._anglePickerRect=null,this._contrastContainer=null,this._contrastRate=null,this._contrastValue=null,this._contrastRelatedElement=null,this._contrastBgColor=null,this._contrastIsLargeText=!1,this._modeContainers=[],this._libraryContainers=[],this._tcolorItems=[],this._tcolorsNavItems=[],this._tcolorsNavContainers=[],this._swatchElements=[],this._documentColorsElements=[],this._tooltips=[],this._swatchesTooltips=[],this._documentColorsTooltips=[],this._libraryTooltips=[],this._sortable=null,this._isColorChangeByPanel=!1,this._gradientWrapper=null,this._gradientPicker=null,this._mode="hex",this._documentColorsContainer=null,this._opacityInputs=[],this._numberInputs=[],this._hexInput=null,this._redInput=null,this._greenInput=null,this._blueInput=null,this._hueInput=null,this._saturationInput=null,this._lightnessInput=null,this._hueRange=null,this._opacityRange=null,this._librarySelect=null,this._modsSelect=null,this._angleInput=null,this._anglePicker=null,this._eyeDropperBtn=null,this._colorArea=null,this._colorAreaPicker=null,this._tcolorsNav=null,this._addSwatchBtn=null,this._swatchesContainer=null,this._gradientSelect=null,this._gradientAngleContainer=null,this._documentColorsOption=null,this._clearBtn=null,this._applyBtn=null,this.close=this.close.bind(this),this.open=this.open.bind(this),this._handleClose=this._handleClose.bind(this),this._handleEyeDropper=this._handleEyeDropper.bind(this),this._handlePointerDown=this._handlePointerDown.bind(this),this._handlePointerMove=this._handlePointerMove.bind(this),this._handlePointerUp=this._handlePointerUp.bind(this),this._handleColorAreaChange=this._handleColorAreaChange.bind(this),this._handleHueRange=this._handleHueRange.bind(this),this._handleOpacityRange=this._handleOpacityRange.bind(this),this._handleModeSelect=this._handleModeSelect.bind(this),this._handleLibrarySelect=this._handleLibrarySelect.bind(this),this._handleTColorsNavClick=this._handleTColorsNavClick.bind(this),this._handleHexKeyDown=this._handleHexKeyDown.bind(this),this._handleNumberKeyDown=this._handleNumberKeyDown.bind(this),this._handleNumberBlur=this._handleNumberBlur.bind(this),this._handleHexBlur=this._handleHexBlur.bind(this),this._handleHexPaste=this._handleHexPaste.bind(this),this._handleNumberPaste=this._handleNumberPaste.bind(this),this._handleTColorsNavScroll=this._handleTColorsNavScroll.bind(this),this._handleTColorItemClick=this._handleTColorItemClick.bind(this),this._handleAddSwatchClick=this._handleAddSwatchClick.bind(this),this._handleAreaPickerKeyDown=this._handleAreaPickerKeyDown.bind(this),this._handleGradientSelect=this._handleGradientSelect.bind(this),this._handleGradientStopSelect=this._handleGradientStopSelect.bind(this),this._adjustAnglePicker=this._adjustAnglePicker.bind(this),this._handleAnglePickerClick=this._handleAnglePickerClick.bind(this),this._handleDocumentKeyUp=this._handleDocumentKeyUp.bind(this),this._handlePanelClick=this._handlePanelClick.bind(this),this._handlePanelKeyDown=this._handlePanelKeyDown.bind(this),this._handleHexInput=this._handleHexInput.bind(this),this._handleNumberInput=this._handleNumberInput.bind(this),this._handleSelect=this._handleSelect.bind(this),this._handleSwatchKeyUp=this._handleSwatchKeyUp.bind(this),this._handleRangeKeyDown=this._handleRangeKeyDown.bind(this),this._handleApplyClick=this._handleApplyClick.bind(this),this._handleClearClick=this._handleClearClick.bind(this),this._dict={EN:{solid:"Solid",linear:"Linear",radial:"Radial",document_colors:"Colors on page",saved_colors:"Saved colors",tilda_colors:"Colors library",tilda_gradients:"Gradients library",save_color:"Save color",pick_color:"Pick color from screen",apply:"Apply",clear:"Clear",contrast_ratio:"Contrast",contrast_hint:"The contrast ratio gauges the level of accessibility of your website for individuals with visual impairments. A satisfactory contrast ratio is determined by the colors used for the foreground and background, as well as the size and weight of the font.",angle:"Angle",gradient_hint:e.gradientHint.EN,copied:"Copied"},RU:{solid:"Сплошной цвет",linear:"Линейный градиент",radial:"Радиальный градиент",document_colors:"Цвета на странице",saved_colors:"Сохранённые цвета",tilda_colors:"Библиотека цветов",tilda_gradients:"Библиотека градиентов",save_color:"Сохранить цвет",pick_color:"Выбрать цвет с экрана",apply:"Применить",clear:"Очистить",contrast_ratio:"Контраст",contrast_hint:"Коэффициент цветового контраста позволяет оценить доступность вашего сайта для людей с нарушением зрения. Он зависит от цвета текста и фона, а также от размера и насыщенности текста.",angle:"Угол",gradient_hint:e.gradientHint.RU,copied:"Скопировано"}}}var e,n;return y(t,[{key:"_translate",value:function(t){return this._dict[this._lang][t]}},{key:"_getSwatches",value:function(){if(!this._swatchesKey)return[];var t=JSON.parse(localStorage.getItem("tMinicolors"));return t&&t[this._swatchesKey]||[]}},{key:"_saveSwatches",value:function(){if(this._swatchesKey){var t=JSON.parse(localStorage.getItem("tMinicolors"))||{};t[this._swatchesKey]=this._swatches,localStorage.setItem("tMinicolors",JSON.stringify(t));this._swatches.length<24?this._addSwatchBtn.style.removeProperty("display"):this._addSwatchBtn.style.display="none"}}},{key:"_updateSwatches",value:function(){var t=this;this._swatchesTooltips.forEach((function(t){return t.destroy()})),this._swatchesTooltips=[],this._swatchElements=Array.from(this._swatchesContainer.querySelectorAll("."+this._className+"__swatch")),this._swatches=this._swatchElements.map((function(t){return t.getAttribute("data-color")})),this._swatchElements.forEach((function(e){var n=t._getSwatchTooltipText(e.getAttribute("data-color"));if(n){var i=new S({element:e,zIndex:t._zIndex+1,text:n,theme:t._theme,onClick:function(n){return t._copyColor(n,e)}});t._swatchesTooltips.push(i)}})),this._saveSwatches(),this._handleHeightChange()}},{key:"_getElementColors",value:function(t){var e=this._isOpacityEnabled&&!this._isGradientOpacityOnly,n=window.getComputedStyle(t),i=[],a=n.getPropertyValue("opacity"),r=n.getPropertyValue("display"),s=n.getPropertyValue("visibility");if("0"===a||"none"===r||"hidden"===s)return i;var o=n.getPropertyValue("background-color"),l=n.getPropertyValue("color"),c=n.getPropertyValue("background-image"),h=n.getPropertyValue("border-color"),d=n.getPropertyValue("border-style"),u=n.getPropertyValue("box-shadow").replace(/\).*/,")");if("none"!==o&&"rgba(0, 0, 0, 0)"!==o){var _=g.parseColor(o,!0),p=g.hslToRGBA(_),m=p[3];(e||1===m)&&i.push("rgba("+p.join(",")+")")}if("none"!==c&&!c.startsWith("url")){var v=g.parseGradient(c,!0);if(v&&this._isGradientsEnabled){var y=k.gradientToCSS(v);i.push(y)}}if("none"!==l&&"rgba(0, 0, 0, 0)"!==l&&t.childNodes.length){var f=g.parseColor(l,!0),C=g.hslToRGBA(f),b=C[3];(e||1===b)&&i.push("rgba("+C.join(",")+")")}if("none"!==h&&"rgba(0, 0, 0, 0)"!==h&&"none"!==d){var w=g.parseColor(h,!0),E=g.hslToRGBA(w),L=E[3];(e||1===L)&&i.push("rgba("+E.join(",")+")")}if("none"!==u&&"rgba(0, 0, 0, 0)"!==u){var S=g.parseColor(u,!0),x=g.hslToRGBA(S),I=x[3];(e||1===I)&&i.push("rgba("+x.join(",")+")")}return i}},{key:"_getDocumentColors",value:function(){var t=this,e=[];document.querySelectorAll(".t396 .tn-elem, .tn-artboard .tn-elem").forEach((function(n){var i=n.querySelector(".tn-atom");if(i){var a=n.getAttribute("data-elem-type");if("button"===a||"shape"===a||"text"===a||"image"===a||"video"===a||"tooltip"===a){var r=t._getElementColors(i);e.push.apply(e,d(r))}}}));return document.querySelectorAll(['.record div[id^="rec"]','.record div[id^="rec"] [field="title"]','.record div[id^="rec"] [field="title"] *','.record div[id^="rec"] [field="descr"]','.record div[id^="rec"] [field="descr"] *','.record div[id^="rec"] [field="text"]','.record div[id^="rec"] [field="text"] *','.record div[id^="rec"] [field="subtitle"]','.record div[id^="rec"] [field="subtitle"] *','.record div[id^="rec"] .t-name','.record div[id^="rec"] .t-name *','.record div[id^="rec"] .t-menu__link-item','.record div[id^="rec"] .t-title','.record div[id^="rec"] .t-title *','.record div[id^="rec"] .t-descr','.record div[id^="rec"] .t-descr *','.record div[id^="rec"] .t-btn','.record div[id^="rec"] .t-btn *','.record div[id^="rec"] a','.record div[id^="rec"] a *'].join(",")).forEach((function(n){var i=t._getElementColors(n);e.push.apply(e,d(i))})),d(new Set(e))}},{key:"_getTildaColors",value:(n=s(a().mark((function t(){var e,n,i,r,s,o,l;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e="https://front.tildacdn.com/colors/colors/colors.json",!((n=JSON.parse(window.localStorage.getItem("tildacolors")))&&Date.now()-n.timestamp<864e5)){t.next=5;break}return t.abrupt("return",new Promise((function(t){t(n)})));case 5:if(window.waitingTildaColorsRequests||(window.waitingTildaColorsRequests=[]),!window.isTildaColorsLoading){t.next=8;break}return t.abrupt("return",new Promise((function(t,e){window.waitingTildaColorsRequests.push({resolve:t,reject:e})})));case 8:if(!window.isTildaColorsLoadFails){t.next=10;break}return t.abrupt("return",new Promise((function(t,e){return e()})));case 10:return window.isTildaColorsLoading=!0,window.isTildaColorsLoadFails=!1,t.prev=12,t.next=15,fetch(e);case 15:return i=t.sent,t.next=18,i.json();case 18:for((r=t.sent).timestamp=Date.now(),window.localStorage.setItem("tildacolors",JSON.stringify(r)),window.isTildaColorsLoading=!1;window.waitingTildaColorsRequests.length;)(0,window.waitingTildaColorsRequests.shift().resolve)(r);return t.abrupt("return",r);case 26:for(t.prev=26,t.t0=t.catch(12),window.isTildaColorsLoading=!1,n||(window.isTildaColorsLoadFails=!0);window.waitingTildaColorsRequests.length;)s=window.waitingTildaColorsRequests.shift(),o=s.resolve,l=s.reject,n?o(n):l(t.t0);return t.abrupt("return",new Promise((function(e,i){n?e(n):i(t.t0)})));case 32:case"end":return t.stop()}}),t,null,[[12,26]])}))),function(){return n.apply(this,arguments)})},{key:"init",value:function(){this._draw(),this._addEvents()}},{key:"destroy",value:function(){var t=this;this._panel.remove(),this._eyeDropperBtn.removeEventListener("click",this._handleEyeDropper),document.removeEventListener("pointerdown",this._handlePointerDown),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp),document.removeEventListener("keyup",this._handleDocumentKeyUp),this._panel.removeEventListener("click",this._handlePanelClick),this._panel.removeEventListener("keydown",this._handlePanelKeyDown),this._colorArea.removeEventListener("colorareachange",this._handleColorAreaChange),this._hueRange.removeEventListener("input",this._handleHueRange),this._opacityRange.removeEventListener("input",this._handleOpacityRange),this._hueRange.removeEventListener("keydown",this._handleRangeKeyDown),this._opacityRange.removeEventListener("keydown",this._handleRangeKeyDown),this._gradientSelect.removeEventListener("change",this._handleGradientSelect),this._gradientSelect.removeEventListener("change",this._handleSelect),this._modsSelect.removeEventListener("change",this._handleModeSelect),this._modsSelect.removeEventListener("change",this._handleSelect),this._librarySelect.removeEventListener("change",this._handleLibrarySelect),this._librarySelect.removeEventListener("change",this._handleSelect),this._tcolorsNav.removeEventListener("scroll",this._handleTColorsNavScroll),this._addSwatchBtn.removeEventListener("click",this._handleAddSwatchClick),this._anglePicker.removeEventListener("click",this._handleAnglePickerClick),this._gradientPicker.element.removeEventListener("tGradientStopSelect",this._handleGradientStopSelect),this._hexInput.removeEventListener("beforeinput",this._handleHexBeforeInput),this._hexInput.removeEventListener("keydown",this._handleHexKeyDown),this._hexInput.removeEventListener("blur",this._handleHexBlur),this._hexInput.removeEventListener("paste",this._handleHexPaste),this._hexInput.removeEventListener("input",this._handleHexInput),this._numberInputs.forEach((function(e){e.removeEventListener("beforeinput",t._handleNumberBeforeInput),e.removeEventListener("keydown",t._handleNumberKeyDown),e.removeEventListener("blur",t._handleNumberBlur),e.removeEventListener("paste",t._handleNumberPaste),e.removeEventListener("input",t._handleNumberInput)})),this._colorAreaPicker.removeEventListener("keydown",this._handleAreaPickerKeyDown),this._tcolorsNavItems.forEach((function(e){e.removeEventListener("click",t._handleTColorsNavClick)})),this._tcolorItems.forEach((function(e){e.removeEventListener("click",t._handleTColorItemClick)})),this._swatchElements.forEach((function(e){e.removeEventListener("click",t._handleTColorItemClick),e.removeEventListener("keyup",t._handleSwatchKeyUp)})),this._documentColorsElements.forEach((function(e){e.removeEventListener("click",t._handleTColorItemClick)})),this._gradientPicker&&this._gradientPicker.destroy(),this._sortable&&this._sortable.destroy(),this._tooltips.forEach((function(t){return t.destroy()})),this._libraryTooltips.forEach((function(t){return t.destroy()})),this._swatchesTooltips.forEach((function(t){return t.destroy()})),this._documentColorsTooltips.forEach((function(t){return t.destroy()}))}},{key:"_getScrollContainer",value:function(){for(var t=this._container,e=["auto","scroll","overlay"];t&&t!==document.documentElement;){var n=window.getComputedStyle(t).getPropertyValue("overflow-y");if(e.includes(n))break;t=t.parentElement}return t||document.documentElement}},{key:"_updatePanelPosition",value:function(){var t=this._panel,e=this._panelGap,n=this._anchorElement.getBoundingClientRect(),i=191,a=405;if(this._isOpacityEnabled&&(a+=25),this._isGradientsEnabled&&(a+=134),this._isTextContrastCheckEnabled&&(a+=35),this._isPanelFixed){t.style.position="fixed",t.style.maxHeight="calc(100vh - 10px)",t.style.translate="clamp(5px, var(--pos-x), calc(100vw - 100% - 5px)) clamp(5px, var(--pos-y), calc(100vh - 100% - 5px))",t.style.top="0",t.style.left="0";var r=document.documentElement.clientWidth,s=document.documentElement.clientHeight-n.top-n.height-e-5>=a,o=n.top-e-5>=a,l=r-n.left-n.width-e-5>=i,c=n.left-e-5>=i,h="0px",d="0px";!s&&(s||o||l||c)?l?(h="".concat(n.left+n.width+e,"px"),d="".concat(n.top,"px")):c?(h="calc(".concat(n.left-e,"px - 100%)"),d="".concat(n.top,"px")):o&&(h="".concat(n.left,"px"),d="calc(".concat(n.top-e,"px - 100%)")):(h="".concat(n.left,"px"),d="".concat(n.top+n.height+e,"px")),t.style.setProperty("--pos-x",h),t.style.setProperty("--pos-y",d)}else{var u=this._isNoInputMode?0:this._anchorElement.offsetTop,_=this._isNoInputMode?0:this._anchorElement.offsetLeft,p=this._anchorElement.offsetWidth,m=document.body.offsetWidth-n.left-i,v=n.left-i,y=document.body.offsetWidth-n.left-p-i;m=Math.min(0,m),v=Math.min(0,v),y=Math.min(0,y);var g=this._anchorElement.offsetHeight;if("bottom-left"===this._position||"bottom-right"===this._position)t.style.top="".concat(u+g+e,"px"),"bottom-left"===this._position?t.style.left="".concat(_+m,"px"):t.style.left="".concat(_+p-i,"px");else if("top-left"===this._position){var f=this._getScrollContainer().scrollTop+n.top-e-a;f=Math.min(0,f),t.style.top="".concat(u-f,"px"),t.style.transform="translateY(-100%)",t.style.left="".concat(_+m,"px")}else"left-top"===this._position?(t.style.top="".concat(u,"px"),t.style.left="".concat(_-v-e,"px"),t.style.transform="translateX(-100%)"):"right-top"===this._position&&(t.style.top="".concat(u,"px"),t.style.left="".concat(_+p+e+y,"px"))}}},{key:"_handleHeightChange",value:function(){if(this._isPanelVisible&&this._panelHeight){var t=this._panel.offsetHeight;if(t!==this._panelHeight){this._panelHeight=t;var e=new L(t);this._isNoInputMode?this._container.dispatchEvent(e):this._input.dispatchEvent(e)}}}},{key:"_draw",value:function(){var t=this,e=function(e){t._eyeDropperBtn=document.createElement("div"),t._eyeDropperBtn.tabIndex=0,t._eyeDropperBtn.role="button",t._eyeDropperBtn.classList.add(t._className+"__eyedropper"),"function"!=typeof window.EyeDropper&&(t._eyeDropperBtn.style.display="none"),e.appendChild(t._eyeDropperBtn)},n=function(){var e=document.createElement("div");return e.classList.add(t._className),"dark"===t._theme&&e.classList.add(t._classNameDark),e.style.setProperty("--current-color","hsl(".concat(t._currentColor.color[0],"turn, ").concat(100*t._currentColor.color[1],"%, ").concat(100*t._currentColor.color[2],"%)")),e.style.setProperty("--current-opacity",t._currentColor.opacity),e.style.setProperty("--current-hue",t._currentColor.color[0]+"turn"),e.style.zIndex=t._zIndex,e}(),i=function(){var e=document.createElement("div");e.classList.add(t._className+"__head"),t._isGradientsEnabled||e.classList.add(t._className+"__head_hidden");return t._gradientSelect=document.createElement("select"),t._gradientSelect.classList.add(t._className+"__gradient-select",t._className+"__select"),["solid","linear","radial"].forEach((function(e){var n=document.createElement("option");n.value=e,n.innerText=t._translate(e),"solid"===e&&(n.selected=!0),t._gradientSelect.appendChild(n)})),e.appendChild(t._gradientSelect),t._gradientHint=document.createElement("div"),t._gradientHint.classList.add(t._className+"__hint",t._className+"__hint_gradient"),t._gradientHint.innerText="!",t._gradientHint.style.display="none",e.appendChild(t._gradientHint),t._tooltips.push(new S({element:t._gradientHint,zIndex:t._zIndex+1,text:t._translate("gradient_hint"),theme:t._theme})),e}(),a=function(){var e=document.createElement("div");e.classList.add(t._className+"__gradients");var n=document.createElement("div");n.classList.add(t._className+"__gradient-wrapper"),n.style.display="none",t._gradientWrapper=n,t._gradientPicker=new k(t._currentColor.gradient,t._handleGradientStopsChange.bind(t)),t._gradientPicker.init();var i=function(){var e=document.createElement("div");e.classList.add(t._className+"__angle"),t._gradientAngleContainer=e;var n=document.createElement("label");n.classList.add(t._className+"__angle-label");var i=document.createElement("span");i.classList.add(t._className+"__angle-span"),i.innerText=t._translate("angle");var a=document.createElement("input");a.classList.add(t._className+"__angle-input",t._className+"__input"),a.type="text",a.maxLength=3,a.setAttribute("data-type","angle"),a.setAttribute("data-min",0),a.setAttribute("data-max",360),a.value="0",t._angleInput=a,t._numberInputs.push(a),n.appendChild(i),n.appendChild(a);var r=document.createElement("div");return r.classList.add(t._className+"__angle-picker"),r.style.setProperty("--angle","0turn"),t._anglePicker=r,e.appendChild(n),e.appendChild(r),e}();return n.appendChild(t._gradientPicker.element),n.appendChild(i),e.appendChild(n),e}();!function(){t._colorArea=document.createElement("div"),t._colorArea.classList.add(t._className+"__area");var e=document.createElement("div");e.classList.add(t._className+"__area-inner"),t._colorAreaPicker=document.createElement("div"),t._colorAreaPicker.classList.add(t._className+"__area-picker"),t._colorAreaPicker.tabIndex=0,t._colorArea.appendChild(e),t._colorArea.appendChild(t._colorAreaPicker)}();var r=function(){var n=document.createElement("div");n.classList.add(t._className+"__inputs");var i=document.createElement("div");i.classList.add(t._className+"__range-outer"),n.appendChild(i);var a=document.createElement("div");return function(){var e=document.createElement("div");e.classList.add(t._className+"__range-container");t._hueRange=document.createElement("input"),t._hueRange.classList.add(t._className+"__range",t._className+"__range_hue"),t._hueRange.type="range",t._hueRange.min=0,t._hueRange.max=1,t._hueRange.step=.001,t._hueRange.value=t._currentColor.color[0],e.appendChild(t._hueRange),t._opacityRange=document.createElement("input"),t._opacityRange.classList.add(t._className+"__range",t._className+"__range_opacity"),t._opacityRange.type="range",t._opacityRange.min=0,t._opacityRange.max=1,t._opacityRange.step=.01,t._opacityRange.value=t._currentColor.opacity,t._isOpacityEnabled&&!t._isGradientOpacityOnly||(t._opacityRange.style.display="none"),e.appendChild(t._opacityRange),i.appendChild(e)}(),function(){a.classList.add(t._className+"__modes");t._modsSelect=document.createElement("select"),t._modsSelect.classList.add(t._className+"__modes-select",t._className+"__select"),t._modsSelect.setAttribute("data-mode","hex"),["hex","rgb","hsl"].forEach((function(e){var n=document.createElement("option");n.value=e,n.innerText=e.toUpperCase(),"hex"===e&&(n.selected=!0),t._modsSelect.appendChild(n)})),a.appendChild(t._modsSelect),["hex","rgb","hsl"].forEach((function(e){var n=document.createElement("div");if(t._modeContainers.push(n),n.classList.add(t._className+"__modes-inputs"),n.setAttribute("data-mode",e),"hex"!==e&&(n.style.display="none"),"hex"===e){t._hexInput=document.createElement("input"),t._hexInput.classList.add(t._className+"__input"),t._hexInput.type="text",t._hexInput.maxLength=7,t._hexInput.value="#"+g.hslToHEX(t._currentColor.color).toUpperCase();var i=document.createElement("input");i.classList.add(t._className+"__input",t._className+"__input_opacity"),i.type="text",i.maxLength=3,t._numberInputs.push(i),t._isOpacityEnabled&&!t._isGradientOpacityOnly||(i.style.display="none"),t._opacityInputs.push(i),n.appendChild(t._hexInput),n.appendChild(i)}else if("rgb"===e){var r=g.hslToRGB(t._currentColor.color);t._redInput=document.createElement("input"),t._redInput.classList.add(t._className+"__input"),t._redInput.type="text",t._redInput.setAttribute("data-min",0),t._redInput.setAttribute("data-max",255),t._redInput.setAttribute("data-type","red"),t._redInput.maxLength=3,t._redInput.value=r[0],t._numberInputs.push(t._redInput),t._greenInput=document.createElement("input"),t._greenInput.classList.add(t._className+"__input"),t._greenInput.type="text",t._greenInput.setAttribute("data-min",0),t._greenInput.setAttribute("data-max",255),t._greenInput.setAttribute("data-type","green"),t._greenInput.maxLength=3,t._greenInput.value=r[1],t._numberInputs.push(t._greenInput),t._blueInput=document.createElement("input"),t._blueInput.classList.add(t._className+"__input"),t._blueInput.type="text",t._blueInput.setAttribute("data-min",0),t._blueInput.setAttribute("data-max",255),t._blueInput.setAttribute("data-type","blue"),t._blueInput.maxLength=3,t._blueInput.value=r[2],t._numberInputs.push(t._blueInput);var s=document.createElement("input");s.classList.add(t._className+"__input",t._className+"__input_opacity"),s.type="text",s.maxLength=3,t._numberInputs.push(s),t._isOpacityEnabled&&!t._isGradientOpacityOnly||(s.style.display="none"),t._opacityInputs.push(s),n.appendChild(t._redInput),n.appendChild(t._greenInput),n.appendChild(t._blueInput),n.appendChild(s)}else if("hsl"===e){var o=t._currentColor.color;o=[Math.round(360*o[0]),Math.round(100*o[0]),Math.round(100*o[0])],t._hueInput=document.createElement("input"),t._hueInput.classList.add(t._className+"__input"),t._hueInput.type="text",t._hueInput.setAttribute("data-min",0),t._hueInput.setAttribute("data-max",360),t._hueInput.setAttribute("data-type","hue"),t._hueInput.maxLength=3,t._hueInput.value=o[0],t._numberInputs.push(t._hueInput),t._saturationInput=document.createElement("input"),t._saturationInput.classList.add(t._className+"__input"),t._saturationInput.type="text",t._saturationInput.setAttribute("data-min",0),t._saturationInput.setAttribute("data-max",100),t._saturationInput.setAttribute("data-type","saturation"),t._saturationInput.maxLength=3,t._saturationInput.value=o[1],t._numberInputs.push(t._saturationInput),t._lightnessInput=document.createElement("input"),t._lightnessInput.classList.add(t._className+"__input"),t._lightnessInput.type="text",t._lightnessInput.setAttribute("data-min",0),t._lightnessInput.setAttribute("data-max",100),t._lightnessInput.setAttribute("data-type","lightness"),t._lightnessInput.maxLength=3,t._lightnessInput.value=o[2],t._numberInputs.push(t._lightnessInput);var l=document.createElement("input");l.classList.add(t._className+"__input",t._className+"__input_opacity"),l.type="text",l.maxLength=3,t._numberInputs.push(l),t._isOpacityEnabled&&!t._isGradientOpacityOnly||(l.style.display="none"),t._opacityInputs.push(l),n.appendChild(t._hueInput),n.appendChild(t._saturationInput),n.appendChild(t._lightnessInput),n.appendChild(l)}a.appendChild(n)})),t._opacityInputs.forEach((function(e){e.value=Math.round(100*t._currentColor.opacity),e.setAttribute("data-min",0),e.setAttribute("data-max",100),e.setAttribute("data-type","opacity")})),n.appendChild(a)}(),t._isOpacityEnabled&&!t._isGradientOpacityOnly?e(i):(a.classList.add(t._className+"__modes_eyedropper"),e(a)),n}();!function(){t._contrastContainer=document.createElement("div"),t._contrastContainer.classList.add(t._className+"__contrast"),t._contrastContainer.style.display="none";var e=document.createElement("div");e.classList.add(t._className+"__contrast-label"),e.innerText=t._translate("contrast_ratio"),t._contrastRate=document.createElement("div"),t._contrastRate.classList.add(t._className+"__contrast-rate"),t._contrastValue=document.createElement("div"),t._contrastValue.classList.add(t._className+"__contrast-value");var n=document.createElement("div");n.innerText="?",n.classList.add(t._className+"__hint",t._className+"__hint_contrast"),t._tooltips.push(new S({element:n,zIndex:t._zIndex+1,text:t._translate("contrast_hint"),theme:t._theme})),t._contrastContainer.append(e,n,t._contrastRate,t._contrastValue)}();var s,o=function(){var e=document.createElement("div");e.classList.add(t._className+"__library");return function(){t._librarySelect=document.createElement("select"),t._librarySelect.classList.add(t._className+"__select",t._className+"__library-select");var n=document.createElement("option");n.value="swatches",n.innerText=t._translate("saved_colors"),t._noDocumentColors&&(n.selected=!0);var i=document.createElement("option");i.value="document-colors",i.innerText=t._translate("document_colors"),t._noDocumentColors||(i.selected=!0),t._documentColorsOption=i;var a=document.createElement("option");a.value="tilda",a.innerText=t._translate("tilda_colors");var r=document.createElement("option");r.value="tilda-gradients",r.innerText=t._translate("tilda_gradients"),t._noDocumentColors||t._librarySelect.appendChild(i),t._librarySelect.appendChild(n),t._librarySelect.appendChild(a),t._isGradientsEnabled&&t._librarySelect.appendChild(r),e.appendChild(t._librarySelect)}(),t._swatchesContainer=document.createElement("div"),t._libraryContainers.push(t._swatchesContainer),t._swatchesContainer.classList.add(t._className+"__swatches"),t._noDocumentColors||(t._swatchesContainer.style.display="none"),t._swatchesContainer.setAttribute("data-library","swatches"),t._addSwatchBtn=document.createElement("div"),t._addSwatchBtn.tabIndex=0,t._addSwatchBtn.role="button",t._addSwatchBtn.classList.add(t._className+"__add-swatch"),t._swatchesContainer.appendChild(t._addSwatchBtn),e.appendChild(t._swatchesContainer),t._documentColorsContainer=document.createElement("div"),t._libraryContainers.push(t._documentColorsContainer),t._documentColorsContainer.classList.add(t._className+"__swatches"),t._documentColorsContainer.setAttribute("data-library","document-colors"),t._noDocumentColors||e.appendChild(t._documentColorsContainer),function(){var n=document.createElement("div");t._libraryContainers.push(n),n.classList.add(t._className+"__tcolors",t._className+"__tcolors_status"),n.setAttribute("data-library","tilda"),n.style.display="none";var i=document.createElement("div");i.classList.add(t._className+"__tcolors-status"),i.innerText="Loading...";var a=document.createElement("div");a.classList.add(t._className+"__tcolors-wrapper");var r=document.createElement("div");r.classList.add(t._className+"__tcolors-nav-wrapper"),t._tcolorsNav=document.createElement("div"),t._tcolorsNav.classList.add(t._className+"__tcolors-nav"),r.appendChild(t._tcolorsNav),a.appendChild(r),n.appendChild(i),n.appendChild(a),e.appendChild(n)}(),function(){var n=document.createElement("div");t._libraryContainers.push(n),n.classList.add(t._className+"__tcolors",t._className+"__tcolors_status"),n.setAttribute("data-library","tilda-gradients"),n.style.display="none";var i=document.createElement("div");i.classList.add(t._className+"__tcolors-status"),i.innerText="Loading...";var a=document.createElement("div");a.classList.add(t._className+"__tcolors-wrapper"),n.appendChild(i),n.appendChild(a),e.appendChild(n)}(),e}();if(n.appendChild(i),n.appendChild(a),n.appendChild(this._colorArea),n.appendChild(r),n.appendChild(this._contrastContainer),n.appendChild(o),this._isNoInputMode){var l=((s=document.createElement("div")).classList.add(t._className+"__btns"),t._clearBtn=document.createElement("div"),t._clearBtn.classList.add(t._className+"__action-btn",t._className+"__action-btn_clear"),t._clearBtn.tabIndex=0,t._clearBtn.role="button",t._clearBtn.textContent=t._translate("clear"),t._applyBtn=document.createElement("div"),t._applyBtn.classList.add(t._className+"__action-btn",t._className+"__action-btn_apply"),t._applyBtn.tabIndex=0,t._applyBtn.role="button",t._applyBtn.textContent=t._translate("apply"),s.append(t._clearBtn,t._applyBtn),s);n.appendChild(l)}if(!this._isPanelFixed){var c=function(){var e=document.createElement("div");return e.classList.add(t._className+"__bottom-gap"),e.style.height="".concat(t._bottomGap,"px"),e}();n.appendChild(c)}this._panel=n}},{key:"_getSwatchTooltipText",value:function(t){if(t.includes("gradient")){var e=g.parseGradient(t,!0),n=e.stops[0]?e.stops[0].color:null,i=e.stops[0]?e.stops[0].opacity:null,a=e.stops[e.stops.length-1]?e.stops[e.stops.length-1].color:null,r=e.stops[e.stops.length-1]?e.stops[e.stops.length-1].opacity:null,s=e.type;if(!n||isNaN(i)||!a||isNaN(r)||!s)return"";var o="#"+g.hslToHEX(n).toUpperCase(),l="#"+g.hslToHEX(a).toUpperCase(),c=1===i?"":Math.floor(100*i)+"% ",h=1===r?"":Math.floor(100*r)+"% ";return(this._translate(s)+"\n"+o+" "+c+"→ "+(e.stops.length>2?"... → ":"")+l+" "+h).trim()}var d=g.parseColor(t,!0),u=isNaN(d[3])?1:d[3];return"#"+g.hslToHEX(d).toUpperCase()+(1===u?"":" "+Math.floor(100*u)+"%")}},{key:"_drawTildaColors",value:function(){var t=this;if(!this._isTildaColorsDrawed){this._isTildaColorsDrawed=!0;var e=this._libraryContainers.find((function(t){return"tilda"===t.getAttribute("data-library")})),n=e.querySelector("."+this._className+"__tcolors-wrapper"),i=e.querySelector("."+this._className+"__tcolors-status");this._getTildaColors().then((function(i){e.classList.remove(t._className+"__tcolors_status"),t._tildaColors=i.colors[0];["blue","aqua","mintgreen","green","lightgreen","yellow","peach","orange","pink","red","purple","violet","darkgray","lightgray","grayshades"].forEach((function(e,i){var a=t._tildaColors[e],r=document.createElement("div");r.tabIndex=0,r.role="button",t._tcolorsNavItems.push(r),r.classList.add(t._className+"__tcolors-nav-item"),i||r.classList.add(t._className+"__tcolors-nav-item_active"),r.innerText="RU"===t._lang?a.name:a.name_en,r.setAttribute("data-color-group",e),t._tcolorsNav.appendChild(r);var s=document.createElement("div");t._tcolorsNavContainers.push(s),s.classList.add(t._className+"__tcolors-list"),s.setAttribute("data-color-group",e),i&&(s.style.display="none"),a.hex.forEach((function(e){var n=document.createElement("div");n.tabIndex=0,n.role="button",t._tcolorItems.push(n),n.classList.add(t._className+"__tcolors-item"),n.setAttribute("data-color",e),n.style.background=e,s.appendChild(n);var i=t._getSwatchTooltipText(e);i&&t._libraryTooltips.push(new S({element:n,zIndex:t._zIndex+1,text:i,theme:t._theme,onClick:function(e){return t._copyColor(e,n)}}))})),n.appendChild(s)})),t._tcolorsNavItems.forEach((function(e){e.addEventListener("click",t._handleTColorsNavClick)})),t._tcolorItems.forEach((function(e){e.addEventListener("click",t._handleTColorItemClick)}))})).catch((function(){i.innerText="Failed to load data"}))}}},{key:"_drawTildaGradients",value:function(){var t=this;if(!this._isTildaGradientsDrawed){this._isTildaGradientsDrawed=!0;var e=this._libraryContainers.find((function(t){return"tilda-gradients"===t.getAttribute("data-library")})),n=e.querySelector("."+this._className+"__tcolors-wrapper"),i=e.querySelector("."+this._className+"__tcolors-status");this._getTildaColors().then((function(i){e.classList.remove(t._className+"__tcolors_status");var a=i.gradients.map((function(t){var e={type:"linear",stops:[{color:g.hexToHSL(t.hex1),position:0,opacity:1},{color:g.hexToHSL(t.hex2),position:1,opacity:1}],angle:0};return k.gradientToCSS(e)})),r=document.createElement("div");r.classList.add(t._className+"__tcolors-list",t._className+"__tcolors-list_gradients"),a.forEach((function(e){var n=document.createElement("div");n.tabIndex=0,n.role="button",t._tcolorItems.push(n),n.classList.add(t._className+"__tcolors-item"),n.setAttribute("data-color",e),n.style.background=e,r.appendChild(n),n.addEventListener("click",t._handleTColorItemClick);var i=t._getSwatchTooltipText(e);i&&t._libraryTooltips.push(new S({element:n,zIndex:t._zIndex+1,text:i,theme:t._theme,onClick:function(e){return t._copyColor(e,n)}}))})),n.appendChild(r)})).catch((function(){i.innerText="Failed to load data"}))}}},{key:"_drawSwatches",value:function(){var t=this;this._swatches=this._getSwatches(),this._swatchElements.forEach((function(e){e.removeEventListener("click",t._handleTColorItemClick),e.remove()})),this._swatchElements=[],this._swatchesTooltips.forEach((function(t){return t.destroy()})),this._swatchesTooltips=[],this._swatches.forEach((function(e){var n=document.createElement("div");n.tabIndex=0,n.role="button",n.classList.add(t._className+"__swatch"),n.style.background=e,n.setAttribute("data-color",e),n.addEventListener("click",t._handleTColorItemClick),n.addEventListener("keyup",t._handleSwatchKeyUp);var i=t._getSwatchTooltipText(e);i&&t._swatchesTooltips.push(new S({element:n,zIndex:t._zIndex+1,text:i,theme:t._theme,onClick:function(e){return t._copyColor(e,n)}}));var a=e.includes("gradient"),r=!1;if(a)for(var s=g.parseGradient(e,!0),o=0;o<s.stops.length;o++){if(s.stops[o].opacity<1){r=!0;break}}var l=e.includes("rgba")&&!a&&1!==g.parseColor(e,!0)[3]||r;(!t._isGradientsEnabled&&a||(!t._isOpacityEnabled||t._isGradientOpacityOnly)&&!a&&l||a&&!t._isOpacityEnabled&&l)&&(n.style.display="none"),t._addSwatchBtn.insertAdjacentElement("beforebegin",n),t._swatchElements.push(n)}));this._swatches.length<24?this._addSwatchBtn.style.removeProperty("display"):this._addSwatchBtn.style.display="none"}},{key:"_drawDocumentColors",value:function(){var t=this;this._documentColors=this._getDocumentColors(),this._documentColorsElements.forEach((function(e){e.removeEventListener("click",t._handleTColorItemClick),e.remove()})),this._documentColorsElements=[],this._documentColorsTooltips.forEach((function(t){return t.destroy()})),this._documentColorsTooltips=[];for(var e=function(){var e=t._documentColors[n],i=document.createElement("div");i.tabIndex=0,i.role="button",i.classList.add(t._className+"__swatch"),i.style.background=e,i.setAttribute("data-color",e),i.addEventListener("click",t._handleTColorItemClick),t._documentColorsElements.push(i),t._documentColorsContainer.appendChild(i);var a=t._getSwatchTooltipText(e);a&&t._documentColorsTooltips.push(new S({element:i,zIndex:t._zIndex+1,text:a,theme:t._theme,onClick:function(e){return t._copyColor(e,i)}}))},n=0;n<this._documentColors.length&&n<24;n++)e();this._documentColorsElements.length?this._documentColorsOption.disabled=!1:(this._librarySelect.value="swatches",this._swatchesContainer.removeAttribute("style"),this._documentColorsContainer.style.display="none",this._documentColorsOption.disabled=!0)}},{key:"_addEvents",value:function(){var t=this;this._eyeDropperBtn.addEventListener("click",this._handleEyeDropper),this._panel.addEventListener("click",this._handlePanelClick),this._panel.addEventListener("keydown",this._handlePanelKeyDown),this._colorArea.addEventListener("colorareachange",this._handleColorAreaChange),this._hueRange.addEventListener("input",this._handleHueRange),this._opacityRange.addEventListener("input",this._handleOpacityRange),this._hueRange.addEventListener("keydown",this._handleRangeKeyDown),this._opacityRange.addEventListener("keydown",this._handleRangeKeyDown),this._gradientSelect.addEventListener("change",this._handleGradientSelect),this._gradientSelect.addEventListener("change",this._handleSelect),this._modsSelect.addEventListener("change",this._handleModeSelect),this._modsSelect.addEventListener("change",this._handleSelect),this._librarySelect.addEventListener("change",this._handleLibrarySelect),this._librarySelect.addEventListener("change",this._handleSelect),this._tcolorsNav.addEventListener("scroll",this._handleTColorsNavScroll),this._addSwatchBtn.addEventListener("click",this._handleAddSwatchClick),this._anglePicker.addEventListener("click",this._handleAnglePickerClick),this._gradientPicker.element.addEventListener("tGradientStopSelect",this._handleGradientStopSelect),this._hexInput.addEventListener("beforeinput",this._handleHexBeforeInput),this._hexInput.addEventListener("keydown",this._handleHexKeyDown),this._hexInput.addEventListener("blur",this._handleHexBlur),this._hexInput.addEventListener("paste",this._handleHexPaste),this._hexInput.addEventListener("input",this._handleHexInput),this._numberInputs.forEach((function(e){e.addEventListener("beforeinput",t._handleNumberBeforeInput),e.addEventListener("keydown",t._handleNumberKeyDown),e.addEventListener("blur",t._handleNumberBlur),e.addEventListener("paste",t._handleNumberPaste),e.addEventListener("input",t._handleNumberInput)})),this._colorAreaPicker.addEventListener("keydown",this._handleAreaPickerKeyDown),this._connectTSortableLite((function(){var e;"function"==typeof window.TSortableLite&&(t._sortable=new window.TSortableLite(t._swatchesContainer,{selector:"."+t._className+"__swatch",handleSelector:"."+t._className+"__swatch",autoScroll:{container:t._swatchesContainer,speedIndex:.4},isAutoUpdateEnabled:!0,ghost:{className:"."+t._className+"__swatch_ghost"},dragImage:{zIndex:99999},onStart:function(){e=t._panel.getBoundingClientRect()},onMove:function(n){var i=n.draggingElement,a=n.originalEvent.clientX,r=n.originalEvent.clientY,s=e.left,o=s+e.width,l=e.top,c=l+e.height;a>=s&&a<=o&&r>=l&&r<=c?(document.documentElement.style.removeProperty("cursor"),t._sortable._dragImage.style.removeProperty("cursor"),i.classList.remove(t._className+"__swatch_del")):(document.documentElement.style.cursor="no-drop",i.classList.add(t._className+"__swatch_del"),t._sortable._dragImage.style.cursor="no-drop")},onDrop:function(e){var n=e.draggingElement;n.classList.contains(t._className+"__swatch_del")&&n.remove(),t._updateSwatches()},onEnd:function(e){var n=e.draggingElement;document.documentElement.style.removeProperty("cursor"),n.classList.contains(t._className+"__swatch_del")&&(n.remove(),t._updateSwatches())}}),t._sortable.init())})),this._tooltips.push(new S({element:this._addSwatchBtn,zIndex:this._zIndex+1,text:this._translate("save_color"),theme:this._theme,onClick:function(e){t._addSwatchBtn.dispatchEvent(new Event("click")),e.remove()}}),new S({element:this._eyeDropperBtn,zIndex:this._zIndex+1,text:this._translate("pick_color"),theme:this._theme,onClick:function(e){t._eyeDropperBtn.dispatchEvent(new Event("click")),e.remove()}})),this._isNoInputMode&&(this._applyBtn.addEventListener("click",this._handleApplyClick),this._clearBtn.addEventListener("click",this._handleClearClick))}},{key:"_handleApplyClick",value:function(){this._onChange.call(null,!1),this.close()}},{key:"_handleClearClick",value:function(){this._updateOpacity(1,!0),this._updateColor(null,!0),this._onChange.call(null,!1,!0),this.close()}},{key:"_handleClose",value:function(t){t.stopPropagation(),this.close()}},{key:"_handleDocumentKeyUp",value:function(t){var e=this;if("Tab"===t.key){var n=document.activeElement;if(this._panel.querySelectorAll("."+this._className+"__select_focus").forEach((function(t){return t.classList.remove(e._className+"__select_focus")})),!n.matches("."+this._className+"__select"))return;n.classList.add(this._className+"__select_focus")}}},{key:"_handlePanelClick",value:function(){var t=this;this._panel.querySelectorAll("."+this._className+"__select_focus").forEach((function(e){return e.classList.remove(t._className+"__select_focus")}))}},{key:"_handlePanelKeyDown",value:function(t){"Enter"!==t.key&&"Space"!==t.key||!("button"===t.target.role||t.target instanceof HTMLSelectElement)||(t.preventDefault(),t.target.dispatchEvent(new Event("click")))}},{key:"_handleEyeDropper",value:function(){var t=this;if("function"==typeof window.EyeDropper){var e=new window.EyeDropper,n="/page/"===window.location.pathname?document.getElementById("closelayer"):null;n&&(n.style.backgroundColor="transparent"),e.open().then((function(e){n&&n.style.removeProperty("background-color"),t._isColorChangeByPanel=!0,t._updateColor(g.hexToHSL(e.sRGBHex))})).catch((function(){n&&n.style.removeProperty("background-color")}))}}},{key:"_handlePointerDown",value:function(t){document.addEventListener("pointermove",this._handlePointerMove),document.addEventListener("pointerup",this._handlePointerUp),this._colorArea.contains(t.target)&&(this._isColorAreaDragStart=!0,this._colorAreaRect=this._colorArea.getBoundingClientRect(),this._adjustColorAreaPicker(t.clientX,t.clientY),document.documentElement.style.setProperty("user-select","none")),(this._hueRange.contains(t.target)||this._opacityRange.contains(t.target))&&(this._isRangeInputStart=!0),(this._anglePicker.contains(t.target)||this._anglePicker===t.target)&&(this._anglePickerRect=this._anglePicker.getBoundingClientRect(),this._anglePickerStart=!0,document.documentElement.style.setProperty("user-select","none")),(this._tcolorsNav.contains(t.target)||this._tcolorsNav===t.target)&&(this._isTcolorsNavDragStart=!0,this._tcolorsNavDragStartPos=t.clientX,document.documentElement.style.setProperty("user-select","none"))}},{key:"_handlePointerMove",value:function(t){this._isColorAreaDragStart&&this._adjustColorAreaPicker(t.clientX,t.clientY),this._anglePickerStart&&this._adjustAnglePicker(t.clientX,t.clientY,t.shiftKey),this._isTcolorsNavDragStart&&this._adjustTcolorsNavScroll(t.clientX)}},{key:"_handlePointerUp",value:function(){var t=this;document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp),this._isColorAreaDragStart&&(document.documentElement.style.removeProperty("user-select"),this._colorAreaPicker.style.removeProperty("will-change"),this._setColorAreaValue(this._currentColor.color),setTimeout((function(){t._isColorAreaDragStart=!1,t._colorAreaPicker.focus()}),0)),this._isRangeInputStart&&setTimeout((function(){t._isRangeInputStart=!1}),0),this._anglePickerStart&&setTimeout((function(){document.documentElement.style.removeProperty("user-select"),t._anglePickerStart=!1}),0),this._isTcolorsNavDragStart&&setTimeout((function(){t._isTcolorsNavDragStart=!1,t._tcolorsNavDragStartPos=null,document.documentElement.style.removeProperty("user-select")}),0)}},{key:"_adjustTcolorsNavScroll",value:function(t){var e=this._tcolorsNavDragStartPos-t;this._tcolorsNavDragStartPos=t,this._tcolorsNav.scrollLeft+=e}},{key:"_handleColorAreaChange",value:function(t){var e=t.value[0],n=t.value[1],i=this._currentColor.color[0],a=e;if(this._isColorChangeByPanel=!0,"hsl"===this._mode){var r=1-n;this._updateColor([i,a,r])}else{var s=1-n;this._updateColor(g.hsvToHSL([i,a,s]))}}},{key:"_handleAreaPickerKeyDown",value:function(t){var e=t.key;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e)){t.preventDefault();var n=t.shiftKey?.05:.01;if(this._isColorChangeByPanel=!0,"hsl"===this._mode){var i=u(this._currentColor.color,3),a=i[0],r=i[1],s=i[2];"ArrowUp"===e?s=(s+=n)>1?1:s:"ArrowRight"===e?r=(r+=n)>1?1:r:"ArrowDown"===e?s=(s-=n)<0?0:s:"ArrowLeft"===e&&(r=(r-=n)<0?0:r),this._updateColor([a,r,s])}else{var o=u(g.hslToHSV(this._currentColor.color),3),l=o[0],c=o[1],h=o[2];"ArrowUp"===e?h=(h+=n)>1?1:h:"ArrowRight"===e?c=(c+=n)>1?1:c:"ArrowDown"===e?h=(h-=n)<0?0:h:"ArrowLeft"===e&&(c=(c-=n)<0?0:c);var d=g.hsvToHSL([l,c,h]);this._updateColor(d)}}}},{key:"_handleHueRange",value:function(){var t=parseFloat(this._hueRange.value),e=this._currentColor.color;this._isColorChangeByPanel=!0,this._updateColor([t,e[1],e[2]])}},{key:"_handleOpacityRange",value:function(){var t=parseFloat(this._opacityRange.value);this._isColorChangeByPanel=!0,this._updateOpacity(t)}},{key:"_handleRangeKeyDown",value:function(t){if(["ArrowRight","ArrowLeft"].includes(t.key)){t.preventDefault();var e=t.target,n=t.shiftKey?.05:.01,i=parseFloat(e.value),a=parseFloat(e.min),r=parseFloat(e.max),s=i;"ArrowRight"==t.key?s+=n:s-=n,s=Math.max(a,s),s=Math.min(r,s),e.value=s,e.dispatchEvent(new Event("input"))}}},{key:"_handleSelect",value:function(t){var e=t.target,n=e.selectedOptions[0],i=document.createElement("div");i.classList.add("select-helper"),i.style.position="fixed",i.style.top="-9999px",i.style.left="-9999px",i.style.width="max-content",i.innerText=n.innerText,this._panel.appendChild(i),setTimeout((function(){e.style.width="".concat(i.offsetWidth,"px"),i.remove()}),0)}},{key:"_showGradient",value:function(t){(this._gradientSelect.value=t,this._handleSelect({target:this._gradientSelect}),"solid"===t)?(this._gradientWrapper.style.display="none",this._isOpacityEnabled&&this._isGradientOpacityOnly&&(this._opacityInputs.forEach((function(t){return t.style.display="none"})),this._opacityRange.style.display="none",this._panel.querySelector("."+this._className+"__modes").insertAdjacentElement("beforeend",this._eyeDropperBtn))):("linear"===t?this._gradientAngleContainer.style.removeProperty("display"):this._gradientAngleContainer.style.display="none",this._gradientWrapper.style.removeProperty("display"),this._isOpacityEnabled&&this._isGradientOpacityOnly&&(this._opacityInputs.forEach((function(t){return t.style.removeProperty("display")})),this._opacityRange.style.removeProperty("display"),this._panel.querySelector("."+this._className+"__range-outer").insertAdjacentElement("beforeend",this._eyeDropperBtn)));this._handleHeightChange()}},{key:"_handleGradientSelect",value:function(t,e){this._isColorChangeByPanel=!0;var n=this._gradientSelect.value;if("solid"===n)return this._currentColor.gradient=null,void this._updateGradient(e);if(this._currentColor.gradient){var i=this._currentColor.gradient;i.type=n,i.angle||(i.angle=0),this._updateGradient(e)}else this._currentColor.gradient={type:n,angle:"linear"===n?0:null,stops:[{color:this._currentColor.color,position:0,opacity:this._currentColor.opacity},{color:this._isOpacityEnabled?this._currentColor.color:[0,0,0],position:1,opacity:this._isOpacityEnabled?0:1}]},this._updateGradient(e);this._handleHeightChange()}},{key:"_handleModeSelect",value:function(){var t=this._modsSelect.value;this._mode=t,this._modeContainers.forEach((function(e){e.getAttribute("data-mode")===t?e.style.removeProperty("display"):e.style.display="none"})),"hsl"===t?this._colorArea.classList.add(this._className+"__area_hsl"):this._colorArea.classList.remove(this._className+"__area_hsl"),this._setColorAreaValue(this._currentColor.color)}},{key:"_handleGradientStopSelect",value:function(t){var e=t.stop.color,n=t.stop.opacity;this._updateColor(e),this._updateOpacity(n)}},{key:"_handleLibrarySelect",value:function(){var t=this._librarySelect.value;if(this._libraryContainers.forEach((function(e){e.getAttribute("data-library")===t?(window.localStorage.setItem("tColorpickerLibrary",t),e.style.removeProperty("display")):e.style.display="none"})),"tilda"===t){var e=this._panel.querySelector("."+this._className+"__tcolors-nav-item_active");e&&(this._tcolorsNav.scrollLeft=e.offsetLeft)}this._handleHeightChange()}},{key:"_handleAddSwatchClick",value:function(){var t,e=this;if(this._isGradientsEnabled&&this._currentColor.gradient)t=k.gradientToCSS(this._currentColor.gradient);else{var n=this._currentColor.color,i=this._currentColor.opacity;if(i<1){var a=g.hslToRGB(n).join(", ");t="rgba(".concat(a,", ").concat(i,")")}else t="#"+g.hslToHEX(n)}var r=document.createElement("div");r.tabIndex=0,r.role="button",r.classList.add(this._className+"__swatch"),r.style.background=t,r.setAttribute("data-color",t);var s=this._getSwatchTooltipText(t);s&&this._swatchesTooltips.push(new S({element:r,zIndex:this._zIndex+1,text:s,theme:this._theme,onClick:function(t){return e._copyColor(t,r)}})),this._addSwatchBtn.insertAdjacentElement("beforebegin",r),this._swatchElements.push(r),this._swatches.push(t),r.addEventListener("click",this._handleTColorItemClick),r.addEventListener("keyup",this._handleSwatchKeyUp),this._swatchesContainer.scrollTop=this._swatchesContainer.scrollHeight,this._saveSwatches(),this._handleHeightChange()}},{key:"_handleTColorsNavClick",value:function(e){var n=this,i=e.target.closest("."+this._className+"__tcolors-nav-item"),a=i.getAttribute("data-color-group");this._tcolorsNavItems.forEach((function(e){if(e===i){var a=i.parentElement;e.classList.add(n._className+"__tcolors-nav-item_active");var r=e.offsetLeft;t.scrollTo({endX:r,endY:0},a)}else e.classList.remove(n._className+"__tcolors-nav-item_active")})),this._tcolorsNavContainers.forEach((function(t){var e=t.getAttribute("data-color-group");a===e?t.style.removeProperty("display"):t.style.display="none"})),this._handleHeightChange()}},{key:"_handleTColorsNavScroll",value:function(){var t=this._tcolorsNav.scrollWidth,e=this._tcolorsNav.clientWidth;this._tcolorsNav.scrollLeft+e>=t-1?this._tcolorsNav.parentElement.classList.add(this._className+"__tcolors-nav-wrapper_scrolled"):this._tcolorsNav.parentElement.classList.remove(this._className+"__tcolors-nav-wrapper_scrolled")}},{key:"_handleTColorItemClick",value:function(t){var e,n=t.target.getAttribute("data-color"),i=n.includes("gradient");if(this._isColorChangeByPanel=!0,i)this._currentColor.gradient=g.parseGradient(n,!0)||null,this._updateGradient();else if("#"===n[0])e=g.hexToHSL(n),this._currentColor.gradient&&t.shiftKey&&(this._gradientSelect.value="solid",this._handleGradientSelect()),this._updateColor(e),this._updateOpacity(1);else if(n.includes("rgba")){var a=g.parseColor(n,!0),r=isNaN(a[3])?1:a[3];a.splice(3),this._currentColor.gradient&&t.shiftKey&&(this._gradientSelect.value="solid",this._handleGradientSelect()),this._updateColor(a),this._updateOpacity(r)}}},{key:"_handleSwatchKeyUp",value:function(t){"Delete"!==t.key&&"Backspace"!==t.key||(t.target.remove(),this._updateSwatches())}},{key:"_handleHexBeforeInput",value:function(t){var e=t.data;e&&/[^a-zA-Z0-9#]/g.test(e)&&t.preventDefault()}},{key:"_handleHexInput",value:function(t){var e=t.target,n=e.value,i=e.selectionStart,a=e.selectionEnd,r=g.parseColor(e.value);this._isColorChangeByPanel=!0,this._updateColor(r),e.value=n,e.selectionStart=i,e.selectionEnd=a}},{key:"_handleHexKeyDown",value:function(t){if(["ArrowUp","ArrowDown","Enter"].includes(t.key)){t.preventDefault();var e,n=t.target,i=g.parseColor(n.value),a=g.hslToRGB(i);"ArrowUp"===t.key?e=a.map((function(t){return 255===t?t:t+1})):"ArrowDown"===t.key?e=a.map((function(t){return 0===t?t:t-1})):"Enter"===t.key&&(e=a);var r=g.rgbToHSL(e);this._isColorChangeByPanel=!0,this._updateColor(r)}}},{key:"_handleHexBlur",value:function(t){var e=t.target;if("#"+g.hslToHEX(this._currentColor.color).toLowerCase()!==e.value.toLowerCase()){var n=g.parseColor(e.value);this._isColorChangeByPanel=!0,this._updateColor(n)}}},{key:"_handleHexPaste",value:function(t){t.preventDefault();var e=t.target,n=e.value,i=(t.clipboardData||window.clipboardData).getData("text").replace(/[^a-zA-Z0-9#]/g,""),a=e.selectionStart,r=e.selectionEnd,s=n.slice(0,a)+i+n.slice(r);s=s.slice(0,7);var o=g.parseColor(s);this._isColorChangeByPanel=!0,this._updateColor(o)}},{key:"_handleNumberBeforeInput",value:function(t){var e=t.data;e&&/[^0-9]/g.test(e)&&t.preventDefault()}},{key:"_handleNumberInput",value:function(t){var e=t.target,n=e.value,i=parseInt(n,10)||0,a=e.selectionStart,r=e.selectionEnd,s=parseInt(e.getAttribute("data-min"),10),o=parseInt(e.getAttribute("data-max"),10);i=Math.min(i,o),i=Math.max(i,s);var l=e.getAttribute("data-type");if(this._isColorChangeByPanel=!0,"opacity"===l)this._updateOpacity(i/100);else if("red"===l||"green"===l||"blue"===l){var c=g.hslToRGB(this._currentColor.color);c[["red","green","blue"].indexOf(l)]=i;var h=g.rgbToHSL(c);this._updateColor(h)}else if("angle"===l){if("historyUndo"===t.inputType&&!this._currentColor.gradient)return;this._currentColor.gradient.angle=i/360,this._updateGradient()}else{var d=this._currentColor.color,u=["hue","saturation","lightness"].indexOf(l),_=d;_[u]=u?i/100:i/360,this._updateColor(_)}e.value=n,e.selectionStart=a,e.selectionEnd=r}},{key:"_handleNumberKeyDown",value:function(t){if(["ArrowUp","ArrowDown","Enter"].includes(t.key)){t.preventDefault();var e,n=t.target,i=parseInt(n.getAttribute("data-min"),10),a=parseInt(n.getAttribute("data-max"),10),r=n.getAttribute("data-type"),s=parseInt(n.value,10)||0;if(e="ArrowUp"===t.key?s<a?s+1:s:"ArrowDown"===t.key&&s>i?s-1:s,this._isColorChangeByPanel=!0,"opacity"===r)this._updateOpacity(e/100);else if("red"===r||"green"===r||"blue"===r){var o=g.hslToRGB(this._currentColor.color);o[["red","green","blue"].indexOf(r)]=e;var l=g.rgbToHSL(o);this._updateColor(l)}else if("angle"===r)this._currentColor.gradient.angle=e/360,this._updateGradient();else{var c=this._currentColor.color,h=["hue","saturation","lightness"].indexOf(r),d=c;d[h]=h?e/100:e/360,this._updateColor(d)}}}},{key:"_handleNumberBlur",value:function(t){var e=t.target,n=parseInt(e.getAttribute("data-min"),10),i=parseInt(e.getAttribute("data-max"),10),a=e.getAttribute("data-type"),r=parseInt(e.value,10)||0,s=r;if(r>i&&(s=i),r<n&&(s=n),this._isColorChangeByPanel=!0,"opacity"===a){if(this._currentColor.opacity===s/100)return;this._updateOpacity(s/100)}else if("red"===a||"green"===a||"blue"===a){var o=g.hslToRGB(this._currentColor.color),l=["red","green","blue"].indexOf(a);if(o[l]===s)return;var c=o;c[l]=s;var h=g.rgbToHSL(c);this._updateColor(h)}else if("angle"===a){if(this._currentColor.gradient.angle===s/360)return;this._currentColor.gradient.angle=s/360,this._updateGradient()}else{var d=this._currentColor.color,u=["hue","saturation","lightness"].indexOf(a);if(d[u]===(u?s/100:s/360))return;var _=d;_[u]=u?s/100:s/360,this._updateColor(_)}}},{key:"_handleNumberPaste",value:function(t){t.preventDefault();var e=t.target,n=e.value,i=e.getAttribute("data-type"),a=(t.clipboardData||window.clipboardData).getData("text").replace(/[^0-9]/g,""),r=e.selectionStart,s=e.selectionEnd,o=n.slice(0,r)+a+n.slice(s);if(o=parseInt(o.slice(0,3))||0,this._isColorChangeByPanel=!0,"opacity"===i)o=o>100?100:o<0?0:o,this._updateOpacity(o/100);else if("red"===i||"green"===i||"blue"===i){o=o>255?255:o<0?0:o;var l=g.hslToRGB(this._currentColor.color);l[["red","green","blue"].indexOf(i)]=o;var c=g.rgbToHSL(l);this._updateColor(c)}else if("angle"===i)this._currentColor.gradient.angle=o/360,this._updateGradient();else{var h=this._currentColor.color,d=["hue","saturation","lightness"].indexOf(i);o=d?o>100?100:o<0?0:o:o>360?360:o<0?0:o;var u=h;u[d]=d?o/100:o/360,this._updateColor(u)}}},{key:"_updateColor",value:function(t,e){t?(this._colorAreaPicker.style.removeProperty("display"),this._colorAreaPicker.tabIndex=0,this._isEmptyColor=!1):(t=[0,0,0],this._colorAreaPicker.style.display="none",this._colorAreaPicker.removeAttribute("tabindex"),this._isEmptyColor=!0),t.splice(3),t=t.map((function(t){return parseFloat(t.toFixed(4))})),this._panel.style.setProperty("--current-color","hsl(".concat(t[0].toFixed(2),"turn, ").concat((100*t[1]).toFixed(2),"%, ").concat((100*t[2]).toFixed(2),"%)")),this._panel.style.setProperty("--current-hue",t[0]+"turn"),this._hexInput.value="#"+g.hslToHEX(t).toUpperCase();var n=u(g.hslToRGB(t),3),i=n[0],a=n[1],r=n[2];this._redInput.value=i,this._greenInput.value=a,this._blueInput.value=r;var s=Math.round(360*t[0]),o=Math.round(100*t[1]),l=Math.round(100*t[2]);this._hueInput.value=s,this._saturationInput.value=o,this._lightnessInput.value=l,this._isColorAreaDragStart||this._setColorAreaValue(t),this._isRangeInputStart||(this._hueRange.value=t[0]),this._currentColor.color=t,this._updateContrast(),this._isGradientsEnabled&&this._currentColor.gradient&&this._gradientPicker.updateSelectedColor(this._currentColor.color,null,e),!this._isColorChangeByPanel||this._currentColor.gradient||this._isNoInputMode||this._onChange.call(null,e)}},{key:"_updateOpacity",value:function(t,e){this._isOpacityEnabled&&(this._panel.style.setProperty("--current-opacity",t),this._opacityInputs.forEach((function(e){e.value=Math.round(100*t)})),this._isRangeInputStart||(this._opacityRange.value=t),this._currentColor.opacity=t,this._isGradientsEnabled&&this._currentColor.gradient&&this._gradientPicker.updateSelectedColor(null,this._currentColor.opacity,e),!this._isColorChangeByPanel||this._currentColor.gradient||this._isNoInputMode||this._onChange.call(null,e))}},{key:"_updateGradient",value:function(t){if(this._updateContrast(),!this._currentColor.gradient){this._gradientHint.style.display="none";var e=this._gradientPicker.selectedStop;return e&&(this._updateColor(e.color,t),this._isOpacityEnabled&&!this._isGradientOpacityOnly?this._updateOpacity(e.opacity,t):this._isGradientOpacityOnly&&this._updateOpacity(1,t),this._showGradient("solid")),void(this._gradientPicker.stops=[])}this._isShowGradientHint&&this._gradientHint.style.removeProperty("display");var n=this._currentColor.gradient.type,i=this._currentColor.gradient.angle||0,a=this._currentColor.gradient.stops;JSON.stringify(a)!==JSON.stringify(this._gradientPicker.stops)&&(this._gradientPicker.stops=a);var r=this._gradientPicker.selectedStop;this._updateColor(r.color,t),this._isOpacityEnabled&&this._updateOpacity(r.opacity,t),this._showGradient(n),this._anglePicker.style.setProperty("--angle",i+"turn"),this._angleInput.value=Math.round(360*i),this._isNoInputMode||this._onChange.call(null,t)}},{key:"_updateContrast",value:function(){var t;this._currentColor.gradient||this._isEmptyColor||!this._contrastBgColor?this._contrastContainer.style.display="none":(this._currentColor.contrast=g.calcContrastRatio(this._currentColor.color,this._contrastBgColor),t=this._contrastIsLargeText&&this._currentColor.contrast>=4.5||this._currentColor.contrast>=7?"AAA":this._contrastIsLargeText&&this._currentColor.contrast>=3||this._currentColor.contrast>=4.5?"AA":"Fail",this._contrastRate.innerText=t,"Fail"===t?this._contrastRate.classList.add(this._className+"__contrast-rate_fail"):this._contrastRate.classList.remove(this._className+"__contrast-rate_fail"),this._contrastValue.innerText=this._currentColor.contrast.toFixed(2),this._contrastContainer.style.removeProperty("display"))}},{key:"_handleGradientStopsChange",value:function(t,e){this._currentColor.gradient.stops=t,this._isNoInputMode||this._onChange.call(null,e)}},{key:"_adjustColorAreaPicker",value:function(t,e){var n=this._colorAreaRect,i=Math.min(t-n.left,n.width);i=Math.max(0,i);var a=Math.min(e-n.top,n.height);a=Math.max(0,a),this._colorAreaPicker.style.willChange="transform",this._colorAreaPicker.style.transform="translate(".concat(i,"px, ").concat(a,"px)");var r=i/n.width,s=a/n.height,o=new C(r,s);this._colorArea.dispatchEvent(o)}},{key:"_handleAnglePickerClick",value:function(t){this._anglePickerRect=this._anglePicker.getBoundingClientRect(),this._adjustAnglePicker(t.clientX,t.clientY)}},{key:"_adjustAnglePicker",value:function(t,e,n){var i=t-(this._anglePickerRect.left+this._anglePickerRect.width/2),a=-1*(e-(this._anglePickerRect.top+this._anglePickerRect.height/2)),r=i/a,s=180*Math.atan(r)/Math.PI;if(a<0?s+=180:i<0&&(s+=360),n){s=15*Math.round(s/15)}s/=360,s=parseFloat(s.toFixed(3)),this._currentColor.gradient.angle=s,this._updateGradient()}},{key:"_setColorAreaValue",value:function(t){var e=this._colorArea.getBoundingClientRect();if("hsl"===this._mode){var n=e.width*t[1],i=e.width*(1-t[2]);this._colorAreaPicker.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}else{var a=g.hslToHSV(t),r=e.width*a[1],s=e.height*(1-a[2]);this._colorAreaPicker.style.transform="translate(".concat(r,"px, ").concat(s,"px)")}}},{key:"_copyColor",value:(e=s(a().mark((function t(e,n){var i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i=n.getAttribute("data-color"),t.next=4,navigator.clipboard.writeText(i);case 4:e.tooltip.style.setProperty("--alt-text","'".concat(this._translate("copied"),"'")),window.setTimeout((function(){e.tooltip&&e.tooltip.style.removeProperty("--alt-text")}),700),t.next=10;break;case 8:t.prev=8,t.t0=t.catch(0);case 10:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(t,n){return e.apply(this,arguments)})},{key:"_connectTSortableLite",value:function(t){var e=document.head.querySelector('link[href*="t-sortable-lite.min.css"]');e||((e=document.createElement("link")).href="https://front.tildacdn.com/plugins/sortable-lite/t-sortable-lite.min.css"+(window.ver?"?v="+window.ver:""),e.rel="stylesheet",document.head.appendChild(e));var n=document.head.querySelector('script[src*="t-sortable-lite.min.js"]');n&&"function"==typeof t?"function"==typeof window.TSortableLite?t.call(this):n.addEventListener("load",t):n||((n=document.createElement("script")).src="https://front.tildacdn.com/plugins/sortable-lite/t-sortable-lite.min.js"+(window.ver?"?v="+window.ver:""),n.async=!0,"function"==typeof t&&n.addEventListener("load",t),document.head.appendChild(n))}},{key:"panelElement",get:function(){return this._panel}},{key:"panelState",get:function(){return this._isPanelVisible}},{key:"close",value:function(){!this._isPanelVisible||this._isColorAreaDragStart||this._isRangeInputStart||this._anglePickerStart||this._gradientPicker._isDragStarted||this._isTcolorsNavDragStart||(this._panel.remove(),this._isPanelVisible=!1,this._contrastRelatedElement=null,this._contrastBgColor=null,document.removeEventListener("pointerdown",this._handlePointerDown),document.removeEventListener("keyup",this._handleDocumentKeyUp),this._gradientPicker.disableDocumentEvents(),(this._input||this._container).dispatchEvent(new E(!1)))}},{key:"open",value:function(){if(!this._isPanelVisible){this._isPanelFixed?document.body.appendChild(this._panel):this._container.appendChild(this._panel),this._isPanelVisible=!0,this._updatePanelPosition(),this._setColorAreaValue(this._currentColor.color),this._noDocumentColors||this._drawDocumentColors(),this._drawTildaColors(),this._drawTildaGradients(),this._drawSwatches();var t=window.localStorage.getItem("tColorpickerLibrary");t&&("document-colors"!==t||this._documentColors.length&&!this._noDocumentColors?"tilda-gradients"!==t||this._isGradientsEnabled||(t=this._documentColors.length&&!this._noDocumentColors?"document-colors":"swatches"):t="swatches",this._librarySelect.value=t,this._librarySelect.dispatchEvent(new Event("change"))),!this._isNoInputMode&&this._isTextContrastCheckEnabled&&(this._contrastRelatedElement=g.getRelatedElement(this._anchorElement)),this._contrastRelatedElement&&(this._contrastBgColor=g.getBgColor(this._contrastRelatedElement),this._contrastIsLargeText=g.isLargeText(this._contrastRelatedElement)),this._updateContrast();var e=this._panel.querySelector("."+this._className+"__tcolors-nav-item_active");e&&(this._tcolorsNav.scrollLeft=e.offsetLeft),this._handleSelect({target:this._gradientSelect}),this._handleSelect({target:this._modsSelect}),this._handleSelect({target:this._librarySelect}),document.addEventListener("pointerdown",this._handlePointerDown),document.addEventListener("keyup",this._handleDocumentKeyUp),this._gradientPicker.enableDocumentEvents(),(this._input||this._container).dispatchEvent(new E(!0)),this._panelHeight=this._panel.offsetHeight}}},{key:"color",get:function(){return this._currentColor.color},set:function(t){this._isColorChangeByPanel=!1,"solid"!==this._gradientSelect.value&&(this._gradientSelect.value="solid",this._handleGradientSelect(null,!0)),this._updateColor(t,!0)}},{key:"opacity",get:function(){return this._currentColor.opacity},set:function(t){this._isColorChangeByPanel=!1,this._updateOpacity(t,!0)}},{key:"gradient",get:function(){return this._currentColor.gradient},set:function(t){this._isColorChangeByPanel=!1,this._currentColor.gradient=t;var e=t?t.type:"solid";this._gradientSelect.value=e,this._handleGradientSelect(null,!0)}},{key:"theme",set:function(t){"dark"===t?(this._theme=t,this._panel.classList.add(this._classNameDark)):"light"===t&&(this._theme=t,this._panel.classList.remove(this._classNameDark))}}],[{key:"throttle",value:function(t,e){var n=this,i=null;return function(){for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];i||(i=window.setTimeout((function(){t.apply(n,r),window.clearTimeout(i),i=null}),e))}}},{key:"scrollTo",value:function(t,e){var n,i=t.endX,a=t.endY,r=e.scrollLeft,s=e.scrollTop;requestAnimationFrame((function t(o){void 0===n&&(n=performance.now());var l,c=(l=(o-n)/300)<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2;e.scrollLeft=r+c*(i-r),e.scrollTop=s+c*(a-s),c<1?requestAnimationFrame(t):(e.scrollLeft=i,e.scrollTop=a)}))}}]),t}(),C=function(n){t(a,n);var i=e(a);function a(t,e){var n;return m(this,a),(n=i.call(this,"colorareachange")).value=[t,e],n}return y(a)}(n(CustomEvent)),b=function(n){t(a,n);var i=e(a);function a(t,e,n){var r;return m(this,a),r=i.call(this,"colorchange"),n&&(n.css=k.gradientToCSS(n)),r.currentColor={hex:null!==t?"#"+g.hslToHEX(t):t,rgb:null!==t?g.hslToRGB(t):t,hsl:t,opacity:e,gradient:n||null},r}return y(a)}(n(CustomEvent)),k=function(){function t(e,n){m(this,t),this._stops=e||[],this._element=null,this._className="tcolors-gradient",this._markers=[],this._isDragStarted=!1,this._selectedMarker=null,this._elementRect=null,this._onChange="function"==typeof n?n:new Function,this._handleMarkerSelect=this._handleMarkerSelect.bind(this),this._handlePointerDown=this._handlePointerDown.bind(this),this._handlePointerMove=this._handlePointerMove.bind(this),this._handlePointerUp=this._handlePointerUp.bind(this),this._handleKeyDown=this._handleKeyDown.bind(this),this._handleClick=this._handleClick.bind(this),this._handleAddMarkerClick=this._handleAddMarkerClick.bind(this)}return y(t,[{key:"init",value:function(){this._element=document.createElement("div"),this._element.classList.add(this._className);var e=t.gradientStopsToString(this._stops);this._element.style.setProperty("--current-gradient",e),this._drawMarkers(),this._element.addEventListener("click",this._handleAddMarkerClick)}},{key:"destroy",value:function(){var t=this;document.removeEventListener("pointerdown",this._handlePointerDown),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp),document.removeEventListener("click",this._handleClick),document.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("click",this._handleAddMarkerClick),this._markers.forEach((function(e){e.removeEventListener("focus",t._handleMarkerSelect)}))}},{key:"enableDocumentEvents",value:function(){document.addEventListener("pointerdown",this._handlePointerDown),document.addEventListener("keydown",this._handleKeyDown)}},{key:"disableDocumentEvents",value:function(){document.removeEventListener("pointerdown",this._handlePointerDown),document.removeEventListener("keydown",this._handleKeyDown)}},{key:"element",get:function(){return this._element}},{key:"stops",get:function(){return this._stops},set:function(e){this._stops=e||[],this._drawMarkers();var n=t.gradientStopsToString(this._stops);this._element.style.setProperty("--current-gradient",n)}},{key:"selectedStop",get:function(){if(!this._selectedMarker||!this._stops.length)return null;var t=parseInt(this._selectedMarker.getAttribute("data-id"),10);return this._stops[t]}},{key:"updateSelectedColor",value:function(e,n,i){if(this._selectedMarker&&this._stops.length){var a=parseInt(this._selectedMarker.getAttribute("data-id"),10);e&&(this._stops[a].color=e),(n||0===n)&&(this._stops[a].opacity=n);var r=t.parseColorToRGBA(this._stops[a].color,this._stops[a].opacity);this._selectedMarker.style.setProperty("--marker-color",r);var s=t.gradientStopsToString(this._stops);this._element.style.setProperty("--current-gradient",s),this._onChange.call(null,this._stops,i)}}},{key:"_drawMarkers",value:function(){var e=this;this._markers.forEach((function(t){t.removeEventListener("focus",e._handleMarkerSelect),t.remove()})),this._markers=[],this._stops.forEach((function(n,i){var a=document.createElement("div");a.classList.add(e._className+"__marker"),a.tabIndex=0,a.setAttribute("data-id",i),a.setAttribute("data-position",n.position),i||(a.classList.add(e._className+"__marker_selected"),e._selectedMarker=a),a.style.left=Math.round(100*n.position)+"%";var r=t.parseColorToRGBA(n.color,n.opacity);a.style.setProperty("--marker-color",r),e._markers.push(a);var s=document.createElement("div");s.classList.add(e._className+"__marker-inner"),a.appendChild(s),e._element.appendChild(a)})),this._markers.forEach((function(t){t.addEventListener("focus",e._handleMarkerSelect)})),this._stops.length>=15?this._element.classList.add(this._className+"_disabled"):this._element.classList.remove(this._className+"_disabled")}},{key:"_updateSelectedMarkerPosition",value:function(e){if(this._selectedMarker){var n=this._selectedMarker;n.style.left=100*e+"%",n.setAttribute("data-position",e);var i=parseInt(n.getAttribute("data-id"),10),a=this._stops[i];a.position=e;var r=this._stops[i-1],s=this._stops[i+1];if(r&&r.position>e){var o=this._markers[i-1];this._stops.splice(i,1),this._stops.splice(i-1,0,a),this._markers.splice(i,1),this._markers.splice(i-1,0,n),n.setAttribute("data-id",i-1),o.setAttribute("data-id",i),o.insertAdjacentElement("beforebegin",n)}else if(s&&s.position<e){var l=this._markers[i+1];this._stops.splice(i,1),this._stops.splice(i+1,0,a),this._markers.splice(i,1),this._markers.splice(i+1,0,n),n.setAttribute("data-id",i+1),l.setAttribute("data-id",i),l.insertAdjacentElement("afterend",n)}var c=t.gradientStopsToString(this._stops);this._element.style.setProperty("--current-gradient",c),this._onChange.call(null,this._stops)}}},{key:"_removeSelectedMarker",value:function(){if(this._selectedMarker&&!(this._markers.length<3)){this._element.classList.remove(this._className+"_disabled");var e=this._selectedMarker,n=parseInt(e.getAttribute("data-id"),10);e.remove();var i=this._markers[n-1],a=this._markers[n+1];this._stops.splice(n,1),this._markers.splice(n,1),this._markers.forEach((function(t,e){t.setAttribute("data-id",e)})),i?i.focus():a&&a.focus();var r=t.gradientStopsToString(this._stops);this._element.style.setProperty("--current-gradient",r),this._onChange.call(null,this._stops)}}},{key:"_handleMarkerSelect",value:function(t){var e=this,n=t.target;this._markers.forEach((function(t){t.classList.remove(e._className+"__marker_selected")})),n.classList.add(this._className+"__marker_selected"),this._selectedMarker=n;var i=parseInt(n.getAttribute("data-id"),10),a=this._stops[i],r=new w(a);this._element.dispatchEvent(r)}},{key:"_handlePointerDown",value:function(t){document.addEventListener("pointermove",this._handlePointerMove),document.addEventListener("pointerup",this._handlePointerUp),document.addEventListener("click",this._handleClick);for(var e=0;e<this._markers.length;e++){var n=this._markers[e];if(n.contains(t.target)||n===t.target){this._isDragStarted=!0,this._elementRect=this._element.getBoundingClientRect(),document.documentElement.style.setProperty("user-select","none");break}}}},{key:"_handleClick",value:function(t){for(var e=0;e<this._markers.length;e++){var n=this._markers[e];if(n.contains(t.target)||n===t.target){t.preventDefault();break}}}},{key:"_handleAddMarkerClick",value:function(e){if(!(e.target!==this._element||this._isDragStarted||this._stops.length>=15)){14===this._stops.length&&this._element.classList.add(this._className+"_disabled");var n=e.clientX;this._elementRect=this._element.getBoundingClientRect();var i=(n-this._elementRect.left)/this._elementRect.width;i=Math.max(0,i),i=Math.min(1,i);for(var a=0,r=this._stops.map((function(t){return t.position})),s=0;s<r.length;s++){var o=r[s],l=r[s+1];if(i<o){a=s;break}if(void 0===l||i>=o&&i<=l){a=s+1;break}}var c={position:i,color:null,opacity:null};if(0===a)c.color=this._stops[0].color,c.opacity=this._stops[0].opacity,this._stops.unshift(c);else if(a===this._stops.length)c.color=this._stops[a-1].color,c.opacity=this._stops[a-1].opacity,this._stops.push(c);else{for(var h=this._stops[a-1],d=this._stops[a],u=(i-h.position)/(d.position-h.position),_=g.hslToRGB(h.color),p=g.hslToRGB(d.color),m=[],v=0;v<3;v++){var y=_[v]+(p[v]-_[v])*u;y=Math.round(y),m.push(y)}c.color=g.rgbToHSL(m),c.opacity=h.opacity+(d.opacity-h.opacity)*u,this._stops.splice(a,0,c)}this._drawMarkers();var f=t.gradientStopsToString(this._stops);this._element.style.setProperty("--current-gradient",f),this._markers[a].focus(),this._onChange.call(null,this._stops)}}},{key:"_handlePointerMove",value:function(t){if(this._isDragStarted){var e=(t.clientX-this._elementRect.left)/this._elementRect.width;if(e=Math.max(0,e),e=Math.min(1,e),t.shiftKey)e=e.toFixed(1);else{var n,i=this._markers.indexOf(this._selectedMarker),a=this._stops[i-1],r=this._stops[i+1];n=a?r?Math.abs(r.position-e)>Math.abs(a.position-e)?a.position:r.position:a.position:r.position,Math.abs(e-n)<.03&&(e=n)}this._updateSelectedMarkerPosition(e)}}},{key:"_handlePointerUp",value:function(){var t=this;document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp),setTimeout((function(){t._isDragStarted=!1,document.documentElement.style.removeProperty("user-select"),document.removeEventListener("click",t._handleClick)}),0)}},{key:"_handleKeyDown",value:function(t){if(this._selectedMarker&&(!this._selectedMarker||document.activeElement===document.body||document.activeElement===this._selectedMarker)&&this._stops.length&&!this._isDragStarted){var e=t.key;if("ArrowLeft"===e){t.preventDefault();var n=this._selectedMarker.getAttribute("data-position");n=parseFloat(n),n-=t.shiftKey?.05:.01,n=Math.max(n,0),this._updateSelectedMarkerPosition(n)}else if("ArrowRight"===e){t.preventDefault();var i=this._selectedMarker.getAttribute("data-position");i=parseFloat(i),i+=t.shiftKey?.05:.01,i=Math.min(i,1),this._updateSelectedMarkerPosition(i)}else"Backspace"===e&&this._removeSelectedMarker()}}}],[{key:"gradientStopsToString",value:function(e){return e.length>1?"linear-gradient(to right,".concat(e.map((function(e){var n=t.parseColorToRGBA(e.color,e.opacity);return"".concat(n," ").concat(Math.round(100*e.position),"%")})).join(","),")"):"transparent"}},{key:"parseColorToRGBA",value:function(t,e){var n=g.hslToRGB(t),i=!isNaN(e)&&e>=0&&e<=1?e:1;return"rgba(".concat(n.join(","),",").concat(i,")")}},{key:"gradientToCSS",value:function(e){var n=e.type,i=e.stops.map((function(e){var n=t.parseColorToRGBA(e.color,e.opacity);return"".concat(n," ").concat(Math.round(100*e.position),"%")})).join(",");return"linear"===n?"linear-gradient(".concat(e.angle,"turn,").concat(i,")"):"radial"===n?"radial-gradient(circle at center,".concat(i,")"):void 0}}]),t}(),w=function(n){t(a,n);var i=e(a);function a(t){var e;return m(this,a),(e=i.call(this,"tGradientStopSelect")).stop={color:t.color,opacity:t.opacity},e}return y(a)}(n(CustomEvent)),E=function(n){t(a,n);var i=e(a);function a(t){var e;return m(this,a),(e=i.call(this,"paneltoggle")).isOpen=t,e}return y(a)}(n(CustomEvent)),L=function(n){t(a,n);var i=e(a);function a(t){var e;return m(this,a),(e=i.call(this,"panelheightchange")).panelHeight=t,e}return y(a)}(n(CustomEvent)),S=function(){function t(e){var n=e.element,i=e.text,a=e.zIndex,r=e.theme,s=e.onHover,o=e.onClick,l=e.onLeave;m(this,t),this.element=n,this.text=i,this.tooltip=null,this.timeoutDuration=400,this.zIndex=a,this.timeout=null,this.parent=document.body,this.theme=["dark","light"].includes(r)?r:"light",this.onHover="function"==typeof s?s.bind(null,this):null,this.onLeave="function"==typeof l?l.bind(null,this):null,this.onClick="function"==typeof o?o.bind(null,this):null,this._handleShow=this._handleShow.bind(this),this._handleHide=this._handleHide.bind(this),this._handleKeyUp=this._handleKeyUp.bind(this),this._init()}return y(t,[{key:"_init",value:function(){this.element.addEventListener("mouseenter",this._handleShow),this.element.addEventListener("mouseleave",this._handleHide),this.element.addEventListener("focus",this._handleShow),this.element.addEventListener("blur",this._handleHide),this.element.addEventListener("keyup",this._handleKeyUp)}},{key:"destroy",value:function(){this.timeout&&window.clearTimeout(this.timeout),this.tooltip&&this.tooltip.remove(),this.element.removeEventListener("mouseenter",this._handleShow),this.element.removeEventListener("mouseleave",this._handleHide),this.element.removeEventListener("focus",this._handleShow),this.element.removeEventListener("blur",this._handleHide),this.element.removeEventListener("keyup",this._handleKeyUp)}},{key:"_draw",value:function(){var t,e=document.createElement("div"),n=["t-tooltip"];"dark"===this.theme&&n.push("t-tooltip_dark"),"function"==typeof this.onClick&&n.push("t-tooltip_clickable"),(t=e.classList).add.apply(t,n),e.innerText=this.text,e.style.zIndex=this.zIndex,this.parent.appendChild(e);var i=this.element.getBoundingClientRect(),a=i.left+i.width/2,r=i.top-12,s=e.getBoundingClientRect();s.height>r&&(r=i.top+i.height+12,e.classList.add("t-tooltip_bottom")),e.style.setProperty("--x","".concat(a,"px")),e.style.setProperty("--y","".concat(r,"px"));var o=(a-(s=e.getBoundingClientRect()).left)/s.width*100;e.style.setProperty("--pin-left","".concat(o,"%")),this.tooltip=e,this.tooltip.addEventListener("mouseenter",this._handleShow),this.tooltip.addEventListener("mouseleave",this._handleHide),this.tooltip.addEventListener("click",this._stopPropagation),this.tooltip.addEventListener("mousedown",this._stopPropagation),this.tooltip.addEventListener("pointerdown",this._stopPropagation),"function"==typeof this.onHover&&this.tooltip.addEventListener("mouseenter",this.onHover),"function"==typeof this.onLeave&&this.tooltip.addEventListener("mouseleave",this.onLeave),"function"==typeof this.onClick&&this.tooltip.addEventListener("click",this.onClick)}},{key:"remove",value:function(){this.tooltip&&(this.tooltip.remove(),this.tooltip.removeEventListener("mouseenter",this._handleShow),this.tooltip.removeEventListener("mouseleave",this._handleHide),this.tooltip.removeEventListener("click",this._handleClick),this.tooltip.removeEventListener("mousedown",this._stopPropagation),this.tooltip.removeEventListener("pointerdown",this._stopPropagation),"function"==typeof this.onHover&&this.tooltip.removeEventListener("mouseenter",this.onHover),"function"==typeof this.onLeave&&this.tooltip.removeEventListener("mouseleave",this.onLeave),"function"==typeof this.onClick&&this.tooltip.removeEventListener("click",this.onClick)),this.tooltip=null}},{key:"_handleShow",value:function(t){if(this.timeout&&window.clearTimeout(this.timeout),!this.tooltip){var e="mouseenter"===t.type?this.timeoutDuration:0;this.timeout=window.setTimeout(this._draw.bind(this),e)}}},{key:"_handleHide",value:function(){var t=this;this.timeout&&window.clearTimeout(this.timeout),this.timeout=window.setTimeout((function(){return t.remove()}),this.timeoutDuration/2)}},{key:"_handleKeyUp",value:function(t){"Escape"===t.key&&t.target===this.element&&this._handleHide()}},{key:"_stopPropagation",value:function(t){t.stopPropagation()}}]),t}();window.TColorPicker=g})();
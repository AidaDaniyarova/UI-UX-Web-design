(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return n(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,i(o.key),o)}}function i(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var i=o.call(t,n||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:String(n)}var r=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof HTMLSelectElement))throw new TypeError("select must be a HTMLSelectElement");n="[object Object]"===Object.prototype.toString.call(n)?n:{},this.config={theme:["light","dark"].includes(n.theme)?n.theme:"light",height:n.height&&!isNaN(n.height)?n.height:40,imageSize:e.getImageSize(n.imageSize),columnsCount:n.columnsCount&&!isNaN(n.columnsCount)?n.columnsCount:2,insertSVG:!!n.insertSVG},this.id=e.getId(),this.select=t,this.disabled=this.select.disabled,this.options=Array.from(this.select.options).map((function(e){return{value:e.value,img:e.getAttribute("data-img")||"",darkImg:e.getAttribute("data-img-dark")||"",label:e.innerText.replace(/\n/g,"").trim(),disabled:e.disabled,selected:e.selected}})),this.isDropdownOpened=!1,this.openDropdown=this.openDropdown.bind(this),this.handleSelectChange=this.handleSelectChange.bind(this),this.handleOptionMouseenter=this.handleOptionMouseenter.bind(this),this.handleOptionMouseleave=this.handleOptionMouseleave.bind(this),this.handleOptionClick=this.handleOptionClick.bind(this),this.handleDocClick=this.handleDocClick.bind(this),this.handleDocKeyDown=this.handleDocKeyDown.bind(this),this.preventScroll=this.preventScroll.bind(this),this.updateDropdownOverflow=this.updateDropdownOverflow.bind(this),this.init()}var n,i,r;return n=e,r=[{key:"getId",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="tprev_",n=0;n<8;n++){var o=Math.floor(62*Math.random());t+=e.charAt(o)}return t}},{key:"getImageSize",value:function(e){var t=Array.isArray(e)?e:[e];return t.length||t.push(180,120),1===t.length&&t.push(t[0]),t.splice(2,t.length),t.every((function(e){return e&&!isNaN(e)}))?t:[180,120]}}],(i=[{key:"init",value:function(){var e=this.config,n=e.theme,o=e.height,i=e.imageSize,r=e.columnsCount,s=e.insertSVG,a=document.createElement("button");a.classList.add("tprev"),a.setAttribute("type","button"),a.setAttribute("role","combobox"),a.setAttribute("aria-expanded","false"),a.setAttribute("aria-controls",this.id),a.setAttribute("aria-owns",this.id),"dark"===n&&a.classList.add("tprev_dark"),a.style.height="".concat(o,"px"),this.disabled&&a.classList.add("tprev_disabled"),this.select.after(a),a.append(this.select),this.select.style.display="none";var d=document.createElement("div");d.classList.add("tprev__selected-option");var l=this.options.find((function(e){return e.selected}));l&&(d.innerHTML=l.label),a.append(d);var c=document.createElement("div");c.classList.add("tprev-dropdown","tprev-dropdown_hidden"),"dark"===n&&c.classList.add("tprev-dropdown_dark"),c.id=this.id;var p=document.createElement("div");p.classList.add("tprev-dropdown__inner"),p.setAttribute("role","listbox"),p.style.gridTemplateColumns="repeat(".concat(r,", ").concat(i[0],"px)"),this.options.forEach((function(e){var t=document.createElement("button");t.type="button",t.classList.add("tprev-dropdown__option"),e.selected&&(t.classList.add("tprev-dropdown__option_selected"),t.ariaSelected=!0),e.disabled&&(t.classList.add("tprev-dropdown__option_disabled"),t.disabled=!0);var o=document.createElement("div");if(o.classList.add("tprev-dropdown__option-image"),o.style.width="".concat(i[0],"px"),o.style.height="".concat(i[1],"px"),e.imageElement=o,t.append(o),e.img){var r="dark"===n&&e.darkImg?e.darkImg:e.img,a=r.endsWith(".svg");e.imgURL=r,e.isSVG=a,a&&s||(o.style.backgroundImage="url('".concat(r,"')"))}var d=document.createElement("div");d.classList.add("tprev-dropdown__option-label"),d.innerHTML=e.label,d.style.maxWidth="".concat(i[0],"px"),t.append(d),e.element=t})),p.append.apply(p,t(this.options.map((function(e){return e.element})))),c.append(p);var h=document.createElement("div");h.classList.add("tprev__noaction"),this.container=a,this.selectedOption=d,this.dropdown=c,this.dropdownInner=p,this.noaction=h,this.setHandlers()}},{key:"setHandlers",value:function(){var e=this;this.container.addEventListener("click",this.openDropdown),this.select.addEventListener("change",this.handleSelectChange),this.options.forEach((function(t){var n=t.element;n.addEventListener("click",e.handleOptionClick),t.disabled||(n.addEventListener("mouseenter",e.handleOptionMouseenter),n.addEventListener("mouseleave",e.handleOptionMouseleave))}))}},{key:"destroy",value:function(){var e=this;this.closeDropdown(),this.container.removeEventListener("click",this.openDropdown),this.select.removeEventListener("change",this.handleSelectChange),this.options.forEach((function(t){var n=t.element;n.removeEventListener("click",e.handleOptionClick),n.removeEventListener("mouseenter",e.handleOptionMouseenter),n.removeEventListener("mouseleave",e.handleOptionMouseleave)})),this.container.before(this.select),this.container.remove()}},{key:"openDropdown",value:function(){var e=this;if(!this.disabled&&!this.isDropdownOpened&&this.options.length){document.addEventListener("click",this.handleDocClick),document.addEventListener("keydown",this.handleDocKeyDown,{capture:!0,passive:!1}),document.addEventListener("wheel",this.preventScroll,{capture:!0,passive:!1}),this.dropdownInner.addEventListener("scroll",this.updateDropdownOverflow);var t=this.container.getBoundingClientRect(),n=t.top,o=t.right+10,i=n-10;this.dropdown.style.setProperty("--pos-x","".concat(o,"px")),this.dropdown.style.setProperty("--pos-y","".concat(i,"px")),document.body.append(this.dropdown),document.body.append(this.noaction),this.isDropdownOpened=!0,this.container.setAttribute("aria-expanded","true"),this.container.classList.add("tprev_active");var r=this.options.find((function(e){return e.selected}));r&&r.element.scrollIntoView({behavior:"smooth",inline:"start",block:"center"}),this.updateDropdownOverflow(),this.dropdown.classList.remove("tprev-dropdown_hidden"),this.config.insertSVG&&this.options.forEach((function(t){var n=t.imgURL,o=t.isSVG;n&&o&&e.loadSVG(n,t)}))}}},{key:"closeDropdown",value:function(){var e=this;this.dropdown.classList.add("tprev-dropdown_hidden"),this.dropdown.addEventListener("transitionend",(function(){document.removeEventListener("click",e.handleDocClick),document.removeEventListener("keydown",e.handleDocKeyDown,{capture:!0,passive:!1}),document.removeEventListener("wheel",e.preventScroll,{capture:!0,passive:!1}),e.dropdownInner.removeEventListener("scroll",e.updateDropdownOverflow),e.dropdown.remove(),e.noaction.remove(),e.isDropdownOpened=!1,e.container.focus(),e.container.setAttribute("aria-expanded","false"),e.container.classList.remove("tprev_active")}),{once:!0})}},{key:"updateDropdownOverflow",value:function(){if(this.isDropdownOpened){this.dropdown.classList.remove("tprev-dropdown_scroll-start","tprev-dropdown_scroll-end");var e=this.dropdownInner,t=e.scrollTop,n=e.scrollLeft,o=e.offsetHeight,i=e.offsetWidth,r=e.scrollHeight,s=e.scrollWidth,a=Math.abs(t-(r-o))<1||r===o,d=Math.abs(n-(s-i))<1||s===i;(s>i||r>i)&&(this.dropdown.classList.toggle("tprev-dropdown_scroll-start",n||t),this.dropdown.classList.toggle("tprev-dropdown_scroll-end",!d||!a))}}},{key:"handleSelectChange",value:function(){var e=this.select.value,t=this.options.find((function(t){return t.value===e}));if(t){var n=this.options.find((function(e){return e.selected}));n&&(n.selected=!1,n.element.classList.remove("tprev-dropdown__option_selected"),n.element.ariaSelected=!1),t.selected=!0,t.element.classList.add("tprev-dropdown__option_selected"),t.element.ariaSelected=!0,this.selectedOption.innerHTML=t.label}}},{key:"handleOptionClick",value:function(e){var t=this,n=e.currentTarget,o=this.options.find((function(e){return e.element===n}));o.disabled||(o.selected||(this.select.value=o.value,window.setTimeout((function(){t.select.dispatchEvent(new Event("change"))}),100)),this.closeDropdown())}},{key:"handleOptionMouseenter",value:function(e){var t=e.currentTarget,n=this.options.find((function(e){return e.element===t}));n&&!n.disabled&&t.focus()}},{key:"handleOptionMouseleave",value:function(e){var t=e.currentTarget,n=this.options.find((function(e){return e.element===t}));n&&!n.disabled&&t.blur()}},{key:"handleDocClick",value:function(e){this.container.contains(e.target)||this.dropdown.contains(e.target)||this.closeDropdown()}},{key:"handleDocKeyDown",value:function(e){if("Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),this.closeDropdown()),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Tab"].includes(e.key)&&(e.preventDefault(),e.stopPropagation()),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){var t=this.config.columnsCount,n=this.options.findIndex((function(e){return e.element===document.activeElement})),o=n%t,i=["ArrowUp","ArrowDown"].includes(e.key)?t:1;if("ArrowLeft"===e.key&&!o||"ArrowRight"===e.key&&o===t-1)return;var r=n+(["ArrowUp","ArrowLeft"].includes(e.key)?-i:i),s=this.options.find((function(e,t){return!e.disabled&&t===r}));s&&s.element.focus()}var a=e.key.toLowerCase();if(/^[a-zа-я]$/.test(a)){e.preventDefault(),e.stopPropagation();var d=this.options.find((function(e){return e.label.toLowerCase().startsWith(a)}));d&&d.element.focus()}}},{key:"preventScroll",value:function(e){if(this.dropdown.contains(e.target)){var t=e.deltaY,n=e.deltaX,o=this.dropdownInner,i=o.scrollTop,r=o.scrollLeft,s=o.offsetHeight,a=o.offsetWidth,d=o.scrollHeight,l=o.scrollWidth,c=Math.abs(i-(d-s))<1,p=Math.abs(r-(l-a))<1,h=l>a,u=d>s;(t<0&&!i&&u||t>0&&c&&u||n<0&&!r&&h||n>0&&p&&h)&&e.preventDefault()}else e.preventDefault()}},{key:"loadSVG",value:function(e,t){var n=this.config.imageSize,o=t.imageElement;t.fetchedSVGPromise||(t.fetchedSVGPromise=fetch(e,{headers:{"Content-Type":"image/svg+xml"}}).then((function(e){return e.text()})).then((function(e){var t=(new DOMParser).parseFromString(e,"image/svg+xml").firstElementChild;if(!(t instanceof SVGElement))throw new Error;return t.classList.add("tprev-dropdown__option-image"),t.setAttribute("width",n[0]),t.setAttribute("height",n[1]),t.setAttribute("preserveAspectRatio","xMidYMid meet"),o.replaceWith(t),t})).catch((function(){delete t.fetchedSVGPromise})))}}])&&o(n.prototype,i),r&&o(n,r),Object.defineProperty(n,"prototype",{writable:!1}),e}();window.TPreviewbox=r})();